<!doctype html>



  


<html class="theme-next pisces use-motion">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
  <link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  
    
      
    

    
  

  

  
    
      
    

    
  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic|Roboto Slab:300,300italic,400,400italic,700,700italic|Lobster Two:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.0.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.0.1" />






<meta name="description" content="Scala,Spark">
<meta property="og:type" content="website">
<meta property="og:title" content="GBW's Blog">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="GBW's Blog">
<meta property="og:description" content="Scala,Spark">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="GBW's Blog">
<meta name="twitter:description" content="Scala,Spark">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: 0,
      author: '博主'
    }
  };
</script>




  <link rel="canonical" href="http://yoursite.com/"/>

  <title> GBW's Blog </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  










  
  
    
  

  <div class="container one-collumn sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">GBW's Blog</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle">Write 1000 Lines a Day to Change My Life!  ٩( 'ω' )و</p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      

      
    </ul>
  

  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/07/14/系统架构-1/" itemprop="url">
                  系统架构(1) 
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-07-14T10:53:05+08:00" content="2016-07-14">
              2016-07-14
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="系统架构"><a href="#系统架构" class="headerlink" title="系统架构"></a>系统架构</h1><p>最近学习了Spark及其生态圈的一些介绍，他的功能很强大，而且通用性很强，感觉使用这一套东西就可以达到我们的要求，而且开发和维护上会方便很多。<br><img src="http://oa4pac8sx.bkt.clouddn.com/overall.png" alt="enter image description here"></p>
<h2 id="数据存储，资源调度"><a href="#数据存储，资源调度" class="headerlink" title="数据存储，资源调度"></a>数据存储，资源调度</h2><p>数据持久化存储在HDFS上，在最底层的分布式文件存储和上层的各种计算框架之间使用中间件Tachyon，将那些不需要落地到HDFS里的文件落地到分布式内存文件系统中来达到共享内存，从而提高效率。以 Standalone或YARN为资源管理器调度 Job 完成 Spark 应用程序的计算。</p>
<h2 id="计算引擎"><a href="#计算引擎" class="headerlink" title="计算引擎"></a>计算引擎</h2><p>以 Spark Core提供的内存计算框架为核心， 使用Spark Streaming做实时处理应用， 监听对应Socket端口，当有图像处理请求时读取图片，调用基于MLlib的机器学习方法库，对图片进行处理后存储回文件系统，显示到客户端上。使用Spark SQL做及时查询。</p>
<h2 id="Tachyno"><a href="#Tachyno" class="headerlink" title="Tachyno"></a>Tachyno</h2><p>使用Tachyon这一分布式内存文件系统,可以在集群里以访问内存的速度来访问存在Tachyon里的文件。Tachyon是架构在最底层的分布式文件存储和上层的各种<br>计算框架之间的一种中间件,其主要职责是将那些不需要落地到DFS里的文件落地到分布式内存文件系统中来达到共享内存,从而提高效率。同时可以减少内存冗余、GC时间等</p>
<p>Tachyon 在 Spark 平台的部署：总的来说，Tachyon 有三个主要的部件：Master， Client，与 Worker。在每个 Spark Worker 节点上，都部署了一个 Tachyon Worker，Spark Worker 通过 Tachyon Client 访问 Tachyon 进行数据读写。所有的 Tachyon Worker 都被 Tachyon Master所管理，Tachyon Master 通过 Tachyon Worker 定时发出的心跳来判断 Worker 是否已经崩溃以及每个 Worker 剩余的内存空间量。<br><img src="http://oa4pac8sx.bkt.clouddn.com/tachyon.jpg" alt="enter image description here"></p>
<h2 id="Standalone"><a href="#Standalone" class="headerlink" title="Standalone"></a>Standalone</h2><ol>
<li>SparkContext 连接到 Master，向 Master 注册并申请资源（CPU Core 和 Memory）；</li>
<li>Master根据 SparkContext的资源申请要求和 Worker心跳周期内报告的信息决定在哪个Worker 上分配资源，然后在该 Worker 上获取资源，然后启动StandaloneExecutorBackend；</li>
<li>StandaloneExecutorBackend 向 SparkContext 注册；</li>
<li>SparkContext 将 Applicaiton 代码发送给 StandaloneExecutorBackend；并且<br>SparkContext 解析 Applicaiton 代码，构建 DAG 图，并提交给 DAG Scheduler 分解成<br>Stage（当碰到 Action 操作时，就会催生 Job；每个 Job 中含有 1 个或多个 Stage，Stage一般在获取外部数据和 shuffle 之前产生），然后以 Stage（或者称为 TaskSet）提交给Task Scheduler，Task Scheduler 负责将 Task 分配到相应的 Worker，最后提交给<br>StandaloneExecutorBackend 执行；</li>
<li>StandaloneExecutorBackend 会建立 Executor 线程池，开始执行 Task，并向<br>SparkContext 报告，直至 Task 完成。</li>
<li>所有 Task 完成后，SparkContext 向 Master 注销，释放资源。<br><img src="http://oa4pac8sx.bkt.clouddn.com/standalone.png" alt="enter image description here"></li>
</ol>
<h2 id="Spark-Core"><a href="#Spark-Core" class="headerlink" title="Spark Core"></a>Spark Core</h2><ol>
<li>构建 Spark Application 的运行环境(启动 SparkContext),SparkContext 向资源管理器(可以是 Standalone、Mesos 或 YARN)注册并申请运行 Executor 资源;</li>
<li>资源管理器分配 Executor 资源并启动 StandaloneExecutorBackend,Executor 运行情况将随着心跳发送到资源管理器上;</li>
<li>SparkContext 构建成 DAG 图,将 DAG 图分解成 Stage,并把 Taskset 发送给 Task<br>Scheduler。Executor 向 SparkContext 申请 Task,Task Scheduler 将 Task 发放给<br>Executor 运行同时 SparkContext 将应用程序代码发放给 Executor。</li>
<li>Task 在 Executor 上运行,运行完毕释放所有资源。<br><img src="http://oa4pac8sx.bkt.clouddn.com/sparkcore.png" alt="enter image description here"></li>
</ol>
<h2 id="Spark-Streaming"><a href="#Spark-Streaming" class="headerlink" title="Spark Streaming"></a>Spark Streaming</h2><p>SparkStreaming 是一个对实时数据流进行高通量、容错处理的流式处理系统,可以对多种数据源(如 Kdfka、Flume、Twitter、Zero 和 TCP 套接字)进行类似 Map、Reduce 和 Join等复杂操作,并将结果保存到外部文件系统、数据库或应用到实时仪表盘。计算流程:Spark Streaming 是将流式计算分解成一系列短小的批处理作业。这里的批处理引擎是 Spark Core,也就是把 Spark Streaming 的输入数据按照 batch size(如 1 秒)分成一段一段的数据(Discretized Stream),每一段数据都转换成 Spark 中的 RDD (Resilient Distributed Dataset),然后将 Spark Streaming 中对 DStream 的 Transformation 操作变为针对 Spark 中对 RDD 的 Transformation 操作,将 RDD 经过操作变成中间结果保存在内存中。整个流式计算根据业务的需求可以对中间的结果进行叠加或者存储到外部设备。下图显示了 Spark Streaming 的整个流程。<br><img src="http://oa4pac8sx.bkt.clouddn.com/sparkstreaming.png" alt="enter image description here"></p>
<h2 id="Spark-SQL"><a href="#Spark-SQL" class="headerlink" title="Spark SQL"></a>Spark SQL</h2><p>类似于关系型数据库,SparkSQL 也是语句也是由 Projection(a1,a2,a3)、Data Source(tableA)、Filter(condition)组成,分别对应 sql 查询过程中的 Result、Data Source、Operation,也就是说 SQL 语句按 Result–&gt;Data Source–&gt;Operation 的次序来描述的。<br>当执行 SparkSQL 语句的顺序为:</p>
<ol>
<li>对读入的 SQL 语句进行解析(Parse),分辨出 SQL 语句中哪些词是关键词(如 SELECT、<br>FROM、WHERE),哪些是表达式、哪些是 Projection、哪些是 Data Source 等,从而判断 SQL 语句是否规范;</li>
<li>将 SQL 语句和数据库的数据字典(列、表、视图等等)进行绑定(Bind),如果相关的Projection、Data Source 等都是存在的话,就表示这个 SQL 语句是可以执行的;</li>
<li>一般的数据库会提供几个执行计划,这些计划一般都有运行统计数据,数据库会在这些计划中选择一个最优计划(Optimize);</li>
<li>计划执行(Execute),按 Operation–&gt;Data Source–&gt;Result 的次序来进行的,在执行过程有时候甚至不需要读取物理表就可以返回结果<br><img src="http://oa4pac8sx.bkt.clouddn.com/spqrksql.png" alt="enter image description here"></li>
</ol>
<h2 id="Spark-MLlib"><a href="#Spark-MLlib" class="headerlink" title="Spark MLlib"></a>Spark MLlib</h2><p>从架构图可以看出 MLlib 主要包含三个部分:<br>底层基础:包括 Spark 的运行库、矩阵库和向量库;<br>算法库:包含广义线性模型、推荐系统、聚类、决策树和评估的算法;<br>实用程序:包括测试数据的生成、外部数据的读入等功能。<br><img src="http://oa4pac8sx.bkt.clouddn.com/MLlib.png" alt="enter image description here"></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/07/13/7-13(2)/" itemprop="url">
                  7.13(2)
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-07-13T20:39:42+08:00" content="2016-07-13">
              2016-07-13
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <p>读写图片文件，网上基本什么也查不到<br>手写读写Bmp图片，用spark MLlib的Kmeans对图片进行压缩<br>写了转化成灰度图和RGB图两种</p>
<p>读写Bmp<br><figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</div><div class="line">  * Created by gbw on 16-7-13.</div><div class="line">  */</span></div><div class="line"></div><div class="line"><span class="keyword">import</span> java.io._</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">object</span> <span class="title">BmpIO</span></span></div><div class="line">&#123;</div><div class="line"></div><div class="line">	<span class="comment">//将数据写入文件</span></div><div class="line">	<span class="function"><span class="keyword">def</span> <span class="title">writeBmp</span></span>(bmpPath: <span class="type">String</span>, red: <span class="type">Array</span>[<span class="type">Array</span>[<span class="type">Int</span>]], green: <span class="type">Array</span>[<span class="type">Array</span>[<span class="type">Int</span>]], blue: <span class="type">Array</span>[<span class="type">Array</span>[<span class="type">Int</span>]]) =</div><div class="line">	&#123;</div><div class="line">		<span class="keyword">val</span> fos = <span class="keyword">new</span> <span class="type">FileOutputStream</span>(bmpPath)</div><div class="line">		<span class="keyword">val</span> dos = <span class="keyword">new</span> <span class="type">DataOutputStream</span>(fos)</div><div class="line">		writeBmp24(dos, red, green ,blue)</div><div class="line">		dos.flush()</div><div class="line">		dos.close()</div><div class="line">		fos.close()</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="comment">//写bmp图片的信息头和文件头还有位图数据</span></div><div class="line">	<span class="function"><span class="keyword">def</span> <span class="title">writeBmp24</span></span>(dos: <span class="type">DataOutputStream</span>, red: <span class="type">Array</span>[<span class="type">Array</span>[<span class="type">Int</span>]], green: <span class="type">Array</span>[<span class="type">Array</span>[<span class="type">Int</span>]], blue: <span class="type">Array</span>[<span class="type">Array</span>[<span class="type">Int</span>]]) =</div><div class="line">	&#123;</div><div class="line">		<span class="keyword">val</span> width = red(<span class="number">0</span>).length</div><div class="line">		<span class="keyword">val</span> height = red.length</div><div class="line"></div><div class="line">		<span class="comment">//14字节的文件头</span></div><div class="line">		<span class="comment">//代表BM</span></div><div class="line">		<span class="keyword">val</span> bfType = <span class="number">0x424d</span>.toShort</div><div class="line">		<span class="comment">// bmp文件的大小（2—5字节）</span></div><div class="line">		<span class="keyword">val</span> bfSize = <span class="number">54</span> + width * height * <span class="number">3</span></div><div class="line">		<span class="comment">// 位图文件保留字，必须为0（6-7字节）</span></div><div class="line">		<span class="keyword">val</span> bfReserved1 = <span class="number">0</span></div><div class="line">		<span class="comment">// 位图文件保留字，必须为0（8-9字节）</span></div><div class="line">		<span class="keyword">val</span> bfReserved2 = <span class="number">0</span></div><div class="line">		<span class="comment">// 文件头开始到位图实际数据之间的字节的偏移量（10-13字节）</span></div><div class="line">		<span class="keyword">val</span> bfOffBits = <span class="number">54</span></div><div class="line"></div><div class="line">		dos writeShort bfType</div><div class="line">		dos write(changeByte(bfSize), <span class="number">0</span>, <span class="number">4</span>)</div><div class="line">		dos write(changeByte(bfReserved1), <span class="number">0</span>, <span class="number">2</span>)</div><div class="line">		dos write(changeByte(bfReserved2), <span class="number">0</span>, <span class="number">2</span>)</div><div class="line">		dos write(changeByte(bfOffBits), <span class="number">0</span>, <span class="number">4</span>)</div><div class="line"></div><div class="line">		<span class="comment">//40字节的信息头</span></div><div class="line">		<span class="comment">// 信息头所需的字节数（14-17字节）</span></div><div class="line">		<span class="keyword">val</span> biSize = <span class="number">40</span></div><div class="line">		<span class="comment">// 位图的宽（18-21字节）</span></div><div class="line">		<span class="keyword">val</span> biWidth = width</div><div class="line">		<span class="comment">// 位图的高（22-25字节）</span></div><div class="line">		<span class="keyword">val</span> biHeight = height</div><div class="line">		<span class="comment">// 目标设备的级别，必须是1（26-27字节）</span></div><div class="line">		<span class="keyword">val</span> biPlanes = <span class="number">1</span></div><div class="line">		<span class="comment">// 每个像素所需的位数（28-29字节），必须是1位（双色）、</span></div><div class="line">		<span class="comment">// 4位（16色）、8位（256色）或者24位（真彩色）之一。</span></div><div class="line">		<span class="keyword">val</span> biBitcount = <span class="number">24</span></div><div class="line">		<span class="comment">// 位图压缩类型，必须是0（不压缩）（30-33字节）、</span></div><div class="line">		<span class="comment">//1（BI_RLEB压缩类型）或2（BI_RLE4压缩类型）之一。</span></div><div class="line">		<span class="keyword">val</span> biCompression = <span class="number">0</span></div><div class="line">		<span class="comment">// 实际位图图像的大小，即整个实际绘制的图像大小（34-37字节）</span></div><div class="line">		<span class="keyword">val</span> biSizeImage = width * height</div><div class="line">		<span class="comment">// 位图水平分辨率，每米像素数（38-41字节）这个数是系统默认值</span></div><div class="line">		<span class="keyword">val</span> biXPelsPerMeter = <span class="number">0</span></div><div class="line">		<span class="comment">// 位图垂直分辨率，每米像素数（42-45字节）这个数是系统默认值</span></div><div class="line">		<span class="keyword">val</span> biYPelsPerMeter = <span class="number">0</span></div><div class="line">		<span class="comment">// 位图实际使用的颜色表中的颜色数（46-49字节），</span></div><div class="line">		<span class="comment">// 如果为0的话，说明全部使用了</span></div><div class="line">		<span class="keyword">val</span> biClrUsed = <span class="number">0</span></div><div class="line">		<span class="comment">// 位图显示过程中重要的颜色数(50-53字节)，</span></div><div class="line">		<span class="comment">// 如果为0的话，说明全部重要</span></div><div class="line">		<span class="keyword">val</span> biClrImportant = <span class="number">0</span></div><div class="line"></div><div class="line">		<span class="comment">// 因为是大端存储，那么也就是说同样会大端输出。</span></div><div class="line">		<span class="comment">// 所以首先调用方法将int数据转变为多个byte数据，</span></div><div class="line">		<span class="comment">// 并且按小端存储的顺序.</span></div><div class="line">		dos write(changeByte(biSize), <span class="number">0</span>, <span class="number">4</span>)</div><div class="line">		dos write(changeByte(biWidth), <span class="number">0</span>, <span class="number">4</span>)</div><div class="line">		dos write(changeByte(biHeight), <span class="number">0</span>, <span class="number">4</span>)</div><div class="line">		dos write(changeByte(biPlanes), <span class="number">0</span>, <span class="number">2</span>)</div><div class="line">		dos write(changeByte(biBitcount), <span class="number">0</span>, <span class="number">2</span>)</div><div class="line">		dos write(changeByte(biCompression), <span class="number">0</span>, <span class="number">4</span>)</div><div class="line">		dos write(changeByte(biSizeImage), <span class="number">0</span>, <span class="number">4</span>)</div><div class="line">		dos write(changeByte(biXPelsPerMeter), <span class="number">0</span>, <span class="number">4</span>)</div><div class="line">		dos write(changeByte(biYPelsPerMeter), <span class="number">0</span>, <span class="number">4</span>)</div><div class="line">		dos write(changeByte(biClrUsed), <span class="number">0</span>, <span class="number">4</span>)</div><div class="line">		dos write(changeByte(biClrImportant), <span class="number">0</span>, <span class="number">4</span>)</div><div class="line"></div><div class="line">		<span class="comment">// 因为是24位图，所以没有颜色表</span></div><div class="line">		<span class="comment">// 通过遍历输入位图数据</span></div><div class="line">		<span class="comment">// 这里遍历的时候注意，在计算机内存中位图数据</span></div><div class="line">		<span class="comment">// 是从左到右，从下到上来保存的，</span></div><div class="line">		<span class="comment">// 也就是说实际图像的第一行的点在内存是最后一行</span></div><div class="line">		<span class="keyword">for</span>(i &lt;- height - <span class="number">1</span> to <span class="number">0</span> by <span class="number">-1</span>)</div><div class="line">		&#123;</div><div class="line">			<span class="keyword">for</span>(j &lt;- <span class="number">0</span> to width - <span class="number">1</span>)</div><div class="line">			&#123;</div><div class="line">				dos write(changeByte(blue(i)(j)), <span class="number">0</span>, <span class="number">1</span>)</div><div class="line">				dos write(changeByte(green(i)(j)), <span class="number">0</span>, <span class="number">1</span>)</div><div class="line">				dos write(changeByte(red(i)(j)), <span class="number">0</span>, <span class="number">1</span>)</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line"></div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="comment">// 将一个int数据转为按小端顺序排列的字节数组</span></div><div class="line">	<span class="function"><span class="keyword">def</span> <span class="title">changeByte</span></span>(data: <span class="type">Int</span>): <span class="type">Array</span>[<span class="type">Byte</span>] =</div><div class="line">		<span class="type">Array</span>(((data &lt;&lt; <span class="number">24</span>) &gt;&gt; <span class="number">24</span>).toByte, ((data &lt;&lt; <span class="number">16</span>) &gt;&gt; <span class="number">24</span>).toByte, ((data &lt;&lt; <span class="number">8</span>) &gt;&gt; <span class="number">24</span>).toByte, (data &gt;&gt; <span class="number">24</span>).toByte)</div><div class="line"></div><div class="line">	<span class="comment">// 将四个字节解析成int数据</span></div><div class="line">	<span class="function"><span class="keyword">def</span> <span class="title">ChangeInt</span></span>(array2: <span class="type">Array</span>[<span class="type">Byte</span>], start: <span class="type">Int</span>) =</div><div class="line">	&#123;</div><div class="line">		<span class="keyword">val</span> i = ((array2(start) &amp; <span class="number">0xff</span>) &lt;&lt; <span class="number">24</span>) | ((array2(start - <span class="number">1</span>) &amp; <span class="number">0xff</span>) &lt;&lt; <span class="number">16</span>)</div><div class="line">		<span class="keyword">val</span> j = ((array2(start - <span class="number">2</span>) &amp; <span class="number">0xff</span>) &lt;&lt; <span class="number">8</span>) | (array2(start - <span class="number">3</span>) &amp; <span class="number">0xff</span>)</div><div class="line">		i | j</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="comment">// 读取rgb数据</span></div><div class="line">	<span class="function"><span class="keyword">def</span> <span class="title">getInf</span></span>(bis: <span class="type">BufferedInputStream</span>, height: <span class="type">Int</span>, width: <span class="type">Int</span>) =</div><div class="line">	&#123;</div><div class="line">		<span class="keyword">val</span> red = <span class="type">Array</span>.ofDim[<span class="type">Int</span>](height, width)</div><div class="line">		<span class="keyword">val</span> green = <span class="type">Array</span>.ofDim[<span class="type">Int</span>](height, width)</div><div class="line">		<span class="keyword">val</span> blue = <span class="type">Array</span>.ofDim[<span class="type">Int</span>](height, width)</div><div class="line"></div><div class="line">		<span class="comment">// 计算系统在每行的填充的字节数</span></div><div class="line">		<span class="keyword">val</span> m = width * <span class="number">3</span> % <span class="number">4</span></div><div class="line">		<span class="keyword">var</span> skip_width = <span class="number">0</span></div><div class="line">		<span class="keyword">if</span>(m != <span class="number">0</span>)</div><div class="line">			skip_width = <span class="number">4</span> - m</div><div class="line"></div><div class="line">		<span class="keyword">for</span> (i &lt;- height - <span class="number">1</span> to <span class="number">0</span> by <span class="number">-1</span>)</div><div class="line">		&#123;</div><div class="line">			<span class="keyword">for</span> (j &lt;- <span class="number">0</span> to width - <span class="number">1</span>)</div><div class="line">			&#123;</div><div class="line">				blue(i)(j) = bis.read</div><div class="line">				green(i)(j) = bis.read</div><div class="line">				red(i)(j) = bis.read</div><div class="line">				<span class="keyword">if</span> (j == <span class="number">0</span>)</div><div class="line">					bis skip skip_width</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line">		(red, green, blue)</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">def</span> <span class="title">readBmp</span></span>(bmpPath: <span class="type">String</span>) =</div><div class="line">	&#123;</div><div class="line">		<span class="keyword">val</span> fin = <span class="keyword">new</span> <span class="type">FileInputStream</span>(bmpPath)</div><div class="line">		<span class="keyword">val</span> bis = <span class="keyword">new</span> <span class="type">BufferedInputStream</span>(fin)</div><div class="line">		<span class="comment">// 获得文件头和信息头的数据</span></div><div class="line">		<span class="comment">//分别是14字节和40字节</span></div><div class="line">		<span class="keyword">val</span> array1 = <span class="keyword">new</span> <span class="type">Array</span>[<span class="type">Byte</span>](<span class="number">14</span>)</div><div class="line">		bis.read(array1, <span class="number">0</span>, <span class="number">14</span>)</div><div class="line">		<span class="keyword">val</span> array2 = <span class="keyword">new</span> <span class="type">Array</span>[<span class="type">Byte</span>](<span class="number">40</span>)</div><div class="line">		bis.read(array2, <span class="number">0</span>, <span class="number">40</span>)</div><div class="line"></div><div class="line">		<span class="comment">// 解析信息头的数据得到位图数据的宽和高</span></div><div class="line">		<span class="keyword">val</span> width = <span class="type">BmpIO</span>.<span class="type">ChangeInt</span>(array2, <span class="number">7</span>)</div><div class="line">		<span class="keyword">val</span> height = <span class="type">BmpIO</span>.<span class="type">ChangeInt</span>(array2, <span class="number">11</span>)</div><div class="line"></div><div class="line">		<span class="comment">//println(s"width: $width, height: $height")</span></div><div class="line">		<span class="keyword">val</span> (red, green, blue) = <span class="type">BmpIO</span>.getInf(bis, height, width)</div><div class="line">		fin.close()</div><div class="line">		bis.close()</div><div class="line">		(width, height, red, green, blue)</div><div class="line">	&#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
          <div class="post-more-link text-center">
            <a class="btn" href="/2016/07/13/7-13(2)/#more" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/07/13/7-13(1)/" itemprop="url">
                  7.13(1)
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-07-13T09:47:18+08:00" content="2016-07-13">
              2016-07-13
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <p>HDFS写回怎么也查不到<br>查看Spark源码里面的函数saveAsHadoopFile终于解决<br>写了个简单的WordCount<br>从hdfs://localhost:9000/gbw/input/…读<br>写回hdfshdfs://localhost:9000/tmp…</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> org.apache.hadoop.io.&#123;<span class="type">IntWritable</span>, <span class="type">Text</span>&#125;</div><div class="line"><span class="keyword">import</span> org.apache.hadoop.mapred.<span class="type">TextOutputFormat</span></div><div class="line"><span class="keyword">import</span> org.apache.spark.&#123;<span class="type">SparkConf</span>, <span class="type">SparkContext</span>&#125;</div><div class="line"></div><div class="line"><span class="comment">/**</div><div class="line">  * Created by gbw on 16-7-13.</div><div class="line">  */</span></div><div class="line"><span class="class"><span class="keyword">object</span> <span class="title">WordCount</span></span></div><div class="line">&#123;</div><div class="line">	<span class="function"><span class="keyword">def</span> <span class="title">FILE_NAME</span></span>: <span class="type">String</span> =<span class="string">"word_count_results"</span></div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> =</div><div class="line">	&#123;</div><div class="line">		<span class="keyword">if</span> (args.length &lt; <span class="number">2</span>)</div><div class="line">		&#123;</div><div class="line">			<span class="type">System</span>.err.print(<span class="string">"Usage: &lt;Input File dir&gt; &lt;Output File dir&gt;"</span>)</div><div class="line">			<span class="type">System</span>.exit(<span class="number">1</span>)</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">val</span> conf = <span class="keyword">new</span> <span class="type">SparkConf</span>().setAppName(<span class="string">"Word count"</span>).setMaster(<span class="string">"local[4]"</span>)</div><div class="line">		<span class="keyword">val</span> sc = <span class="keyword">new</span> <span class="type">SparkContext</span>(conf)</div><div class="line">		<span class="keyword">val</span> textFile = sc.textFile(args(<span class="number">0</span>))</div><div class="line">		<span class="keyword">val</span> wordCounts = textFile.flatMap(line =&gt; line.split(<span class="string">" "</span>)).map(word =&gt; (word,<span class="number">1</span>)).reduceByKey((a,b) =&gt; a+b)</div><div class="line">		<span class="comment">//wordCounts.saveAsTextFile(FILE_NAME + System.currentTimeMillis())</span></div><div class="line">		wordCounts.saveAsHadoopFile(args(<span class="number">1</span>),classOf[<span class="type">Text</span>],classOf[<span class="type">IntWritable</span>],classOf[<span class="type">TextOutputFormat</span>[<span class="type">Text</span>,<span class="type">IntWritable</span>]])</div><div class="line">		println(<span class="string">"Word count successfully saved!"</span>)</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
          <div class="post-more-link text-center">
            <a class="btn" href="/2016/07/13/7-13(1)/#more" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/07/12/Plan2/" itemprop="url">
                  Plan2
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-07-12T16:04:47+08:00" content="2016-07-12">
              2016-07-12
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>那么现在搞定了：<br>1.HDFS 读数据<br>2.SparkStreaming时时计算<br>3.Spark MLlib Kmeans算法<br>那么要把它们连在一起做时时图像处理，可以考虑做视频，要做的是：<br>1.HDFS读取图片<br>2.Kmean图像处理<br>3.写回（HDFS，或者本地<br>4..加入SparkStreaming，模拟时时产生图片，做计算，写回<br>5.搞一个前端交互<br>6.SparkStreaming监控前端，做图像处理，搞定！</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/07/12/7-12(3)/" itemprop="url">
                  7-12(3)
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-07-12T15:56:55+08:00" content="2016-07-12">
              2016-07-12
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <p>Spark MLlib 封装的很好的，上手并不难，写了个简单的Kmeans 聚类</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> org.apache.log4j.&#123;<span class="type">Level</span>, <span class="type">Logger</span>&#125;</div><div class="line"><span class="keyword">import</span> org.apache.spark.&#123;<span class="type">SparkConf</span>, <span class="type">SparkContext</span>&#125;</div><div class="line"><span class="keyword">import</span> org.apache.spark.mllib.clustering.<span class="type">KMeans</span></div><div class="line"><span class="keyword">import</span> org.apache.spark.mllib.linalg.<span class="type">Vectors</span></div><div class="line"><span class="class"><span class="keyword">object</span> <span class="title">Kmeans</span></span></div><div class="line">&#123;</div><div class="line">	<span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>])</div><div class="line">	&#123;</div><div class="line">		<span class="type">Logger</span>.getLogger(<span class="string">"org.apache.spark"</span>).setLevel(<span class="type">Level</span>.<span class="type">WARN</span>)</div><div class="line">		<span class="type">Logger</span>.getLogger(<span class="string">"org.eclipse.jetty.server"</span>).setLevel(<span class="type">Level</span>.<span class="type">OFF</span>)</div><div class="line"></div><div class="line">		<span class="comment">// 设置运行环境</span></div><div class="line">		<span class="keyword">val</span> conf = <span class="keyword">new</span> <span class="type">SparkConf</span>().setAppName(<span class="string">"MyKmeans"</span>).setMaster(<span class="string">"local[4]"</span>)</div><div class="line">		<span class="keyword">val</span> sc = <span class="keyword">new</span> <span class="type">SparkContext</span>(conf)</div><div class="line"></div><div class="line">		<span class="comment">// 装载数据集</span></div><div class="line">		<span class="keyword">val</span> data = sc.textFile(<span class="string">"/home/gbw/Sparkdata/Kmeans/input"</span>, <span class="number">1</span>)</div><div class="line">		<span class="keyword">val</span> parsedData = data.map(s =&gt; <span class="type">Vectors</span>.dense(s.split(' ').map(_.toDouble)))</div><div class="line"></div><div class="line">		<span class="comment">// 将数据集聚类,2 个类,20 次迭代,进行模型训练形成数据模型</span></div><div class="line">		<span class="keyword">val</span> numClusters = <span class="number">2</span></div><div class="line">		<span class="keyword">val</span> numIterations = <span class="number">20</span></div><div class="line">		<span class="keyword">val</span> model = <span class="type">KMeans</span>.train(parsedData, numClusters, numIterations)</div><div class="line"></div><div class="line">		<span class="comment">// 打印数据模型的中心点</span></div><div class="line">		println(<span class="string">"Cluster centers:"</span>)</div><div class="line">		<span class="keyword">for</span> (c &lt;- model.clusterCenters)</div><div class="line">		&#123;</div><div class="line">			println(<span class="string">" "</span> + c.toString)</div><div class="line">		&#125;</div><div class="line"></div><div class="line">		<span class="comment">// 使用误差平方之和来评估数据模型</span></div><div class="line">		<span class="keyword">val</span> cost = model.computeCost(parsedData)</div><div class="line">		println(<span class="string">"Within Set Sum of Squared Errors = "</span> + cost)</div><div class="line"></div><div class="line">		<span class="comment">// 使用模型测试单点数据</span></div><div class="line">		println(<span class="string">"Vectors 0.2 0.2 0.2 is belongs to clusters:"</span> + model.predict(<span class="type">Vectors</span>.dense(<span class="string">"0.2 0.2 0.2"</span>.split(' ').map(_.toDouble))))</div><div class="line">		println(<span class="string">"Vectors 0.25 0.25 0.25 is belongs to clusters:"</span> + model.predict(<span class="type">Vectors</span>.dense(<span class="string">"0.25 0.25 0.25"</span>.split(' ').map(_.toDouble))))</div><div class="line">		println(<span class="string">"Vectors 8 8 8 is belongs to clusters:"</span> + model.predict(<span class="type">Vectors</span>.dense(<span class="string">"8 8 8"</span>.split(' ').map(_.toDouble))))</div><div class="line">		<span class="keyword">val</span> testdata = data.map(s =&gt; <span class="type">Vectors</span>.dense(s.split(' ').map(_.toDouble)))</div><div class="line">		<span class="keyword">val</span> result1 = model.predict(testdata)</div><div class="line">		result1.saveAsTextFile(<span class="string">"/home/gbw/Sparkdata/Kmeans/result_kmeans1"</span>)</div><div class="line"></div><div class="line">		<span class="comment">// 交叉评估 2,返回数据集和结果</span></div><div class="line">		<span class="keyword">val</span> result2 = data.map</div><div class="line">		&#123;</div><div class="line">			line =&gt;</div><div class="line">				<span class="keyword">val</span> linevectore = <span class="type">Vectors</span>.dense(line.split(' ').map(_.toDouble))</div><div class="line">				<span class="keyword">val</span> prediction = model.predict(linevectore)</div><div class="line">				line + <span class="string">" "</span> + prediction</div><div class="line">		&#125;.saveAsTextFile(<span class="string">"/home/gbw/Sparkdata/Kmeans/result_kmeans2"</span>)</div><div class="line">		sc.stop()</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
          <div class="post-more-link text-center">
            <a class="btn" href="/2016/07/12/7-12(3)/#more" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/07/12/7-12(2)/" itemprop="url">
                  7-12(2)
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-07-12T13:31:00+08:00" content="2016-07-12">
              2016-07-12
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <p>SparkStreaming<br>终于搞定了Demo<br>生成模拟数据流，监听指定端口，当建立链接时，每秒向该端口发送数据流</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> java.io.&#123;<span class="type">PrintWriter</span>&#125;</div><div class="line"><span class="keyword">import</span> java.net.<span class="type">ServerSocket</span></div><div class="line"><span class="keyword">import</span> scala.io.<span class="type">Source</span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">object</span> <span class="title">Gen</span></span></div><div class="line">&#123;</div><div class="line"></div><div class="line">	<span class="comment">// 定义随机获取整数的方法</span></div><div class="line">	<span class="function"><span class="keyword">def</span> <span class="title">index</span></span>(length: <span class="type">Int</span>) =</div><div class="line">	&#123;</div><div class="line">		<span class="keyword">import</span> java.util.<span class="type">Random</span></div><div class="line">		<span class="keyword">val</span> rdm = <span class="keyword">new</span> <span class="type">Random</span></div><div class="line">		rdm.nextInt(length)</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>])</div><div class="line">	&#123;</div><div class="line"></div><div class="line">		<span class="comment">// 调用该模拟器需要三个参数，分为为文件路径、端口号和间隔时间（单位：毫秒）</span></div><div class="line">		<span class="keyword">if</span> (args.length != <span class="number">3</span>)</div><div class="line">		&#123;</div><div class="line">			<span class="type">System</span>.err.println(<span class="string">"Usage: &lt;filename&gt; &lt;port&gt; &lt;millisecond&gt;"</span>)</div><div class="line">			<span class="type">System</span>.exit(<span class="number">1</span>)</div><div class="line">		&#125;</div><div class="line"></div><div class="line">		<span class="comment">// 获取指定文件总的行数</span></div><div class="line">		<span class="keyword">val</span> filename = args(<span class="number">0</span>)</div><div class="line">		<span class="keyword">val</span> lines = <span class="type">Source</span>.fromFile(filename).getLines.toList</div><div class="line">		<span class="keyword">val</span> filerow = lines.length</div><div class="line"></div><div class="line">		<span class="comment">// 指定监听某端口，当外部程序请求时建立连接</span></div><div class="line">		<span class="keyword">val</span> listener = <span class="keyword">new</span> <span class="type">ServerSocket</span>(args(<span class="number">1</span>).toInt)</div><div class="line">		<span class="keyword">while</span> (<span class="literal">true</span>)</div><div class="line">		&#123;</div><div class="line">			<span class="keyword">val</span> socket = listener.accept()</div><div class="line">			<span class="keyword">new</span> <span class="type">Thread</span>()</div><div class="line">			&#123;</div><div class="line">				<span class="keyword">override</span> <span class="function"><span class="keyword">def</span> <span class="title">run</span> </span>=</div><div class="line">				&#123;</div><div class="line">					println(<span class="string">"Got client connected from: "</span> + socket.getInetAddress)</div><div class="line">					<span class="keyword">val</span> out = <span class="keyword">new</span> <span class="type">PrintWriter</span>(socket.getOutputStream, <span class="literal">true</span>)</div><div class="line">					<span class="keyword">while</span> (<span class="literal">true</span>)</div><div class="line">					&#123;</div><div class="line">						<span class="type">Thread</span>.sleep(args(<span class="number">2</span>).toLong)</div><div class="line">						<span class="comment">// 当该端口接受请求时，随机获取某行数据发送给对方</span></div><div class="line">						<span class="keyword">val</span> content = lines(index(filerow))</div><div class="line">						println(content)</div><div class="line">						out.write(content + '\n')</div><div class="line">						out.flush()</div><div class="line">					&#125;</div><div class="line">					socket.close()</div><div class="line">				&#125;</div><div class="line">			&#125;.start()</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>运行</p>
          <div class="post-more-link text-center">
            <a class="btn" href="/2016/07/12/7-12(2)/#more" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/07/12/7-12/" itemprop="url">
                  7.12
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-07-12T10:17:31+08:00" content="2016-07-12">
              2016-07-12
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <p>统计平均年龄<br>首先生成数据：Gen.scala<br>生成1000000个人的0-99年龄<br>每一行 i + rand(100)<br><figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</div><div class="line">  * Created by gbw on 16-7-10.</div><div class="line">  */</span></div><div class="line"><span class="keyword">import</span> java.io.<span class="type">FileWriter</span></div><div class="line"><span class="keyword">import</span> java.io.<span class="type">File</span></div><div class="line"><span class="keyword">import</span> scala.util.<span class="type">Random</span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">object</span> <span class="title">Gen</span></span></div><div class="line">&#123;</div><div class="line">	<span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args:<span class="type">Array</span>[<span class="type">String</span>])</div><div class="line">	&#123;</div><div class="line">		<span class="keyword">val</span> writer = <span class="keyword">new</span> <span class="type">FileWriter</span>(<span class="keyword">new</span> <span class="type">File</span>(<span class="string">"/home/gbw/sample_age_data.txt"</span>),<span class="literal">false</span>)</div><div class="line">		<span class="keyword">val</span> rand = <span class="keyword">new</span> <span class="type">Random</span>()</div><div class="line">		<span class="keyword">for</span> ( i &lt;- <span class="number">1</span> to <span class="number">1000000</span>)</div><div class="line">		&#123;</div><div class="line">			writer.write( i + <span class="string">" "</span> + rand.nextInt(<span class="number">100</span>))</div><div class="line">			writer.write(<span class="type">System</span>.getProperty(<span class="string">"line.separator"</span>))</div><div class="line">		&#125;</div><div class="line">		writer.flush()</div><div class="line">		writer.close()</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>Spark计算平均年龄</p>
          <div class="post-more-link text-center">
            <a class="btn" href="/2016/07/12/7-12/#more" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/07/11/7-11/" itemprop="url">
                  7.11
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-07-11T21:01:51+08:00" content="2016-07-11">
              2016-07-11
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>在git上面搭建博客gbwen.github.io<br>使用NexT主题，并排版美化好<br>SparkStreaming学习，但是视频里面的程序对着敲没跑通<br>整理一下，明天：<br>1.PeopleAge统计<br>        1)fileText<br>    2)HDFS<br>2.SparkStreaming<br>    1)Network<br>    2)HDFS<br>后天：<br>SparkStreaming图片处理<br>大后天：<br>MLlib<br>可以的话加入SparkStreaming</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/07/10/7-10/" itemprop="url">
                  7-10
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-07-10T19:13:56+08:00" content="2016-07-10">
              2016-07-10
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>学习 深入Spark内核 迷迷糊糊<br>搞定Idea + Spark环境<br>原来：<br>新建工程：spark scala 2.10.6 不能用2.11.8!!!!!<br>VM option: -Dspark.master=local<br>打包运行./spark-submit –class “SparkPi” –master local[4] /home/gbw/Mytest.jar<br>Class为主类的名字</p>
<p>SparkPi.scala</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">/**</div><div class="line">  * Created by gbw on 16-7-10.</div><div class="line">  */</div><div class="line">import scala.math.random</div><div class="line">import org.apache.spark._</div><div class="line"></div><div class="line">/** Computes an approximation to pi */</div><div class="line">object SparkPi &#123;</div><div class="line">	def main(args: Array[String]) &#123;</div><div class="line">		val conf = new SparkConf().setAppName(&quot;Spark Pi&quot;)</div><div class="line">		val spark = new SparkContext(conf)</div><div class="line">		val slices = if (args.length &gt; 0) args(0).toInt else 2</div><div class="line">		val n = math.min(100000L * slices, Int.MaxValue).toInt // avoid overflow</div><div class="line">		val count = spark.parallelize(1 until n, slices).map &#123; i =&gt;</div><div class="line">				val x = random * 2 - 1</div><div class="line">				val y = random * 2 - 1</div><div class="line">				if (x*x + y*y &lt; 1) 1 else 0</div><div class="line">			&#125;.reduce(_ + _)</div><div class="line">		println(&quot;Pi is roughly &quot; + 4.0 * count / n)</div><div class="line">		spark.stop()</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/07/10/7-9/" itemprop="url">
                  7.9
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-07-10T08:18:27+08:00" content="2016-07-10">
              2016-07-10
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>学习 Spark生态系统介绍，Spark整体概述与Spark编程模型<br>本地./spark-shell 在shell运行spark语句OK<br>但是idea 打包成jar 怎么也不对 Fuck！</p>
<p>例子：<br>1.数组map(2*<em>)全部翻倍，filter(</em>&gt;6)筛选&gt;6的</p>
<pre><code>val filterRRdd = sc.parallelize(List(1,2,3,4,5,6,7,8,9)).map(2*_).filter(_&gt;6).collect
</code></pre><p>2.union合并，但是join笛卡尔积</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">val rdd1 = sc.parallelize(List((&apos;a&apos;,1),(&apos;a&apos;,2)))</div><div class="line">val rdd2 = sc.parallelize(List((&apos;b&apos;,1),(&apos;b&apos;,2)))</div><div class="line">val result = rdd1 union rdd2</div><div class="line">result.collect</div><div class="line">//Array[(Char, Int)] = Array((a,1), (a,2), (b,1), (b,2))</div></pre></td></tr></table></figure>
<p>3.WordCount</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">val rdd = sc.textFile(&quot;/home/gbw/myspark/1/data.txt&quot;) </div><div class="line">rdd.cache</div><div class="line">rdd.count</div><div class="line">//  Long = 13</div><div class="line"></div><div class="line">val wordCount = rdd.flatMap(_.split(&apos; &apos;)).map((_,1)).reduceByKey(_+_)</div><div class="line">wordCount.collect</div><div class="line">//Array[(String, Int)] = Array((b,5), (h,14), (&quot;&quot;,1), (n,10), (f,14), (j,19), (r,5), (s,5), (e,5), (a,10), (k,10), (y,5), (u,5), (g,9), (m,4))</div><div class="line">wordCount.saveAsTextFile(&quot;/home/gbw/myspark/1/out&quot;)</div><div class="line">//输出到文件</div><div class="line"></div><div class="line">val wordCount2 = rdd.flatMap(_.split(&apos; &apos;)).map((_,1)).groupByKey()</div><div class="line">//Array[(String, Iterable[Int])] = Array((b,CompactBuffer(1, 1, 1, 1, 1)), (h,CompactBuffer(1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1)), (&quot;&quot;,CompactBuffer(1)), (n,CompactBuffer(1, 1, 1, 1, 1, 1, 1, 1, 1, 1)), (f,CompactBuffer(1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1)), (j,CompactBuffer(1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1)), (r,CompactBuffer(1, 1, 1, 1, 1)), (s,CompactBuffer(1, 1, 1, 1, 1)), (e,CompactBuffer(1, 1, 1, 1, 1)), (a,CompactBuffer(1, 1, 1, 1, 1, 1, 1, 1, 1, 1)), (k,CompactBuffer(1, 1, 1, 1, 1, 1, 1, 1, 1, 1)), (y,CompactBuffer(1, 1, 1, 1, 1)), (u,CompactBuffer(1, 1, 1, 1, 1)), (g,CompactBuffer(1, 1, 1, 1, 1, 1, 1, 1, 1)), (m,CompactBuffer(1, 1, 1, 1)))</div><div class="line"></div><div class="line">val wordCount = rdd.flatMap(_.split(&apos; &apos;)).map((_,1)).reduceByKey(_+_).map(x =&gt; (x._2,x._1)).sortByKey(false).map(x=&gt;(x._2,x._1))</div><div class="line">//Array[(String, Int)] = Array((j,19), (h,14), (f,14), (n,10), (a,10), (k,10), (g,9), (b,5), (r,5), (s,5), (e,5), (y,5), (u,5), (m,4), (&quot;&quot;,1))</div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel  sidebar-panel-active ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="http://oa4pac8sx.bkt.clouddn.com/u=4284545010,775528643&fm=21&gp=0.jpg"
               alt="GBW" />
          <p class="site-author-name" itemprop="name">GBW</p>
          <p class="site-description motion-element" itemprop="description">Scala,Spark</p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">14</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">6</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/GBWen" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://blog.sina.com.cn/u/5660562931" target="_blank" title="曾经博客">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                  曾经博客
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://user.qzone.qq.com/376366210" target="_blank" title="QQ空间">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                  QQ空间
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://www.zhihu.com/people/guan-bo-wen-98" target="_blank" title="知乎">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                  知乎
                </a>
              </span>
            
          
        </div>

        
        

        
        

      </section>

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2016</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">GBW</span>
</div>

<div class="powered-by">
  由 <a class="theme-link" href="http://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Pisces
  </a>
</div>

        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.0.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.0.1"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.0.1"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.0.1"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.0.1"></script>



  



  




  
  

  

  

  

</body>
</html>
