<!doctype html>



  


<html class="theme-next pisces use-motion">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
  <link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  
    
      
    

    
  

  

  
    
      
    

    
  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic|Roboto Slab:300,300italic,400,400italic,700,700italic|Lobster Two:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.0.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.0.1" />






<meta name="description" content="Scala,Spark">
<meta property="og:type" content="website">
<meta property="og:title" content="GBW's Blog">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="GBW's Blog">
<meta property="og:description" content="Scala,Spark">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="GBW's Blog">
<meta name="twitter:description" content="Scala,Spark">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: 0,
      author: '博主'
    }
  };
</script>




  <link rel="canonical" href="http://yoursite.com/"/>

  <title> GBW's Blog </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  










  
  
    
  

  <div class="container one-collumn sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">GBW's Blog</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle">Write 1000 Lines a Day to Change My Life!  ٩( 'ω' )و</p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      

      
    </ul>
  

  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/09/22/近期资料整理/" itemprop="url">
                  近期资料整理
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-09-22T07:55:01+08:00" content="2016-09-22">
              2016-09-22
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="分布式图片服务器"><a href="#分布式图片服务器" class="headerlink" title="分布式图片服务器"></a>分布式图片服务器</h2><p>大流量、高并发、海量存储<br>使用负载均衡和分布式存储，能够在已定成都上解决并发访问量高和存储量大的问题。</p>
<ol>
<li>用户上传图片到web服务器，web服务器处理完图片，然后再由前段web服务器把图片post到图片服务器中，图片服务器接收post过来的图片，然后把图片写入到本地磁盘并返回对应的成功状态码。前端web服务器根据返回状态码决定对应的操作，如果成功的话处理生成各个尺寸的缩略图/打水印，把图片服务器对应的ID和对应的图片路径写入DB数据库。</li>
<li>上传控制：只需要修改web服务器post到的目的图片服务器的ID就可以控制上传到哪台图片存储服务器，对应的图片存储服务器只需要安装nginx同时提供python或者php或者java服务并保存图片，也可以编写一个nginx扩展模块。</li>
<li>用户访问流程：用户访问页面的时候，根据请求图片的URL到对应的图片服务器访问图片</li>
</ol>
<p>分布式存储的必要性：自动提供冗余，不需要我们去备份，担心数据安全，还有一点就是分布式存储动态扩容方便<br>上传和下载的分开处理：上传与下载分开，能保证不会因下载的压力影响图片的上传，而且还有一点，下载入口和上传入口的负载均衡策略也不同<br>使用cache做缓存: 分布式存储解决了存储安全问题，但性能问题还需要用cache去解决<br>使用一致性哈希做负载均衡<br>使用CDN分发和多域名访问入口: 采用多域名能够加快图片展示的速度</p>
<h2 id="WEB-地图"><a href="#WEB-地图" class="headerlink" title="WEB 地图"></a>WEB 地图</h2><p>1.分级<br>经过行业里的长期发展，业内逐渐采用了分级代替了比例尺，一般使用0~18这样得分级数表示。<br>级数每增加1级，那么比例尺实际是变大2倍。 这个分级数一般用z表示<br>现在业内流行的投影方式是谷歌发明的 web墨卡托</p>
<ol>
<li>分块<br>现在第0级是256<em>256的地图图片，当第1级的时候就是512</em>512，每一级变为2倍。这样当到18级的时候，整个地图的分辨率是个天文数字，这样任意一台计算机都无法在瞬间完成下载，读取和显示。<br>实际上把某一级地图 完整下载也是没有意义的，因为我们的屏幕分辨率有限，超出屏幕的范围图片都是浪费。</li>
<li>地图块的生成<br>电子地图的生成一般是地理几何数据（点，线，面）按照一定的规则， 配置不同的显示样式，预渲染成图片</li>
<li>矢量地图块<br>现在我们用的手机地图 和 运行在chrome浏览器的地图 基本都不是栅格图片形式了，而是一块块的矢量数据。</li>
</ol>
<h2 id="Leaflet"><a href="#Leaflet" class="headerlink" title="Leaflet"></a>Leaflet</h2><p>一个开源的JavaScript地图库，支持绘制矢量图层</p>
<p>矢量渲染对比栅格地图的好处，大概有以下几个方面：<br>数据更新更快更及时——由于地理数据是海量级别的，制作地图切片可能要消耗几个小时、几天甚至更长，而客户端矢量渲染理论上则可以支持实时更新。<br>释放客户端的缓存空间，节省流量——原来客户端需要缓存大量的地图切片，而矢量渲染则仅需要传输GeoJson字串，大大节省流量，这一点在移动端显得尤为重要。<br>客户端支持矢量编辑——以往，在客户端仅为图片展示，编辑数据是不可能的。</p>
<h2 id="GIS"><a href="#GIS" class="headerlink" title="GIS"></a>GIS</h2><p>1：数据库层次的<br>Oracle 11g R2 RAC环境进行简单介绍<br>RAC相关原理<br>数据存储<br>ArcSDE在该环境下的部署<br>请参考：<a href="http://blog.csdn.net/linghe301/article/details/12997803" target="_blank" rel="external">http://blog.csdn.net/linghe301/article/details/12997803</a></p>
<p>2：GIS服务器层次的<br>GIS服务器集群<br>请参考：<a href="http://blog.csdn.net/linghe301/article/details/13001035" target="_blank" rel="external">http://blog.csdn.net/linghe301/article/details/13001035</a><br>3：Web服务器层次的<br>负载均衡<br>WebAdapor<br>请参考：<a href="http://blog.csdn.net/linghe301/article/details/13001035" target="_blank" rel="external">http://blog.csdn.net/linghe301/article/details/13001035</a></p>
<p>4：数据安全方面的<br>反向代理<br>防火墙<br>DNS</p>
<p>请参考：<a href="http://blog.csdn.net/linghe301/article/details/13291855" target="_blank" rel="external">http://blog.csdn.net/linghe301/article/details/13291855</a></p>
<h2 id="SWC"><a href="#SWC" class="headerlink" title="SWC"></a>SWC</h2><p>SWC File Format<br>The format of an SWC file is fairly simple. It is a text file consisting of a header with various fields beginning with a # character, and a series of three dimensional points containing an index, radius, type, and connectivity information. The lines in the text file representing points have the following layout.<br>n T x y z R P<br>n is an integer label that identifies the current point and increments by one from one line to the next.<br>T is an integer representing the type of neuronal segment, such as soma, axon, apical dendrite, etc. The standard accepted integer values are given below.<br>0 = undefined<br>1 = soma<br>2 = axon<br>3 = dendrite<br>4 = apical dendrite<br>5 = fork point<br>6 = end point<br>7 = custom<br>x, y, z gives the cartesian coordinates of each node.<br>R is the radius at that node.<br>P indicates the parent (the integer label) of the current point or -1 to indicate an origin (soma).<br>An example file generated by NeuronStudio containing just 8 points is shown below. Note that some of the fields of the header are missing values. At the time of this writing it is unclear whether this is allowed. NeuronStudio fills in SHRINKAGE_CORRECTION and SCALE with 1.0 in case a potential SWC reader uses these fields. </p>
<p>1 1 14.566132 34.873772 7.857000 0.717830 -1<br>2 0 16.022520 33.760513 7.047000 0.463378 1<br>3 5 17.542000 32.604973 6.885001 0.638007 2<br>4 0 19.163984 32.022469 5.913000 0.602284 3<br>5 0 20.448090 30.822802 4.860000 0.436025 4<br>6 6 21.897903 28.881084 3.402000 0.471886 5<br>7 0 18.461960 30.289471 8.586000 0.447463 3<br>8 6 19.420759 28.730757 9.558000 0.496217 7</p>
<h2 id="Neutube"><a href="#Neutube" class="headerlink" title="Neutube"></a>Neutube</h2><p>n  （Gn, Pn, Cn, Sn）, where （G n  xn, yn, zn, rn）<br>两个组件：SWC可视化和用户输入的响应，用户输入纠正识别错误。<br>3D视图是非常适合用于显示全球结构和2D视图提供密集的地方结构的精确推断<br>图像分析：该模块提供了一个神经元或神经元分支的自动跟踪，以允许用户获得神经元结构具有最小的相互作用。找到分支结点和端点。<br>软件结合2D / 3D可视化，半自动化的跟踪算法，以及灵活的编辑选项，以简化神经元的任务重建</p>
<h2 id="Catmaid"><a href="#Catmaid" class="headerlink" title="Catmaid"></a>Catmaid</h2><p>CATMAID是图像的大量数据协作注释工具包。它被设计来导航，共享和协同注释生物标本的海量图像数据集。接口来源自GoogleMaps，同它的基本导航概念，增强，允许通过光学或物理切片显微技术获得的生物的三维图像数据的探索启发。该接口使地区的利益，通过书签，并通过多个已注册的数据集无缝共享同步导航。</p>
<p>随着大量的生物图像数据集是不切实际的创造一个可持续的集中存储库。 CATMAID的一个独特功能是它的半分布式体系结构，其中所呈现的图像数据可以驻留在任何互联网访问的服务器上，但可在中央数据库容易交叉引用。这样，没有图像数据被复制和数据生产者保持对他们的形象完全控制。</p>
<p>CATMAID是打算作为数据共享平台，采用高分辨率成像技术探测大样本生物学家。任何高通量，高含量成像项目如基因表达模式的屏幕将来自对数据共享和注解的接口中受益。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/09/19/9-20近期安排/" itemprop="url">
                  9.20近期安排
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-09-19T20:29:53+08:00" content="2016-09-19">
              2016-09-19
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>仔细浏览下面的技术资料，结合GIS和google、baidu地图服务中的图片服务器架构</p>
<p>基于DVID的大数据神经元重建系统</p>
<p>服务器端DVID存储大型多通道神经元图像数据及辅助类型，如多分辨率图像数据和神经元（SWC）模型数据等</p>
<p>网页客户端支持图像和模型数据的浏览 (参考neuTube）</p>
<p>计算服务系统支持自动分配计算资源对图像数据进行自动重建，产生神经元模型 （使用SPARK）</p>
<p>NeuTu客户端支持图像和模型数据的浏览，并对模型的数据进行修正。网页客户端也可支持部分修正功能。</p>
<p>SWC定义：<a href="http://research.mssm.edu/cnic/swc.html" target="_blank" rel="external">http://research.mssm.edu/cnic/swc.html</a></p>
<p>参考文献：</p>
<p>CATMAID</p>
<p>neuTube: <a href="http://eneuro.org/content/2/1/ENEURO.0049-14.2014" target="_blank" rel="external">http://eneuro.org/content/2/1/ENEURO.0049-14.2014</a></p>
<p>DVID-SPARK: <a href="https://github.com/janelia-flyem/DVIDSparkServices" target="_blank" rel="external">https://github.com/janelia-flyem/DVIDSparkServices</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/09/15/DVID-问题解决/" itemprop="url">
                  DVID 问题解决
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-09-15T08:59:48+08:00" content="2016-09-15">
              2016-09-15
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>使用<a href="https://github.com/janelia-flyem/dvid-console" target="_blank" rel="external">https://github.com/janelia-flyem/dvid-console</a>    1.14.4版本的dvid-console就没有之前所说的问题了，可以看到这次使用了新的显示插件Leaflet，而不是OpenSeaDragon，Leaflet网站<a href="http://leafletjs.com/，an" target="_blank" rel="external">http://leafletjs.com/，an</a> open-source JavaScript library for mobile-friendly interactive maps，但是dvid-console这个版本没有缩放功能，先放下吧，先进行下去</p>
<p><img src="http://oa4pac8sx.bkt.clouddn.com/2016-09-15%2009:23:18%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE.png" alt="enter image description here"></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/09/13/Spark-架构实现/" itemprop="url">
                  Spark 架构实现
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-09-13T19:30:50+08:00" content="2016-09-13">
              2016-09-13
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <p>SparkBmpIO.scala<br><figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> java.io.<span class="type">PrintWriter</span></div><div class="line"><span class="keyword">import</span> java.net.<span class="type">URI</span></div><div class="line"></div><div class="line"><span class="keyword">import</span> org.apache.log4j.&#123;<span class="type">Level</span>, <span class="type">Logger</span>&#125;</div><div class="line"><span class="keyword">import</span> org.apache.spark.&#123;<span class="type">SparkConf</span>, <span class="type">SparkContext</span>&#125;</div><div class="line"><span class="keyword">import</span> org.apache.hadoop.conf.<span class="type">Configuration</span></div><div class="line"><span class="keyword">import</span> org.apache.hadoop.fs.<span class="type">FileSystem</span></div><div class="line"><span class="keyword">import</span> org.apache.hadoop.fs.<span class="type">Path</span></div><div class="line"><span class="keyword">import</span> org.apache.hadoop.fs._</div><div class="line"></div><div class="line"><span class="keyword">import</span> scala.io.<span class="type">Source</span></div><div class="line"></div><div class="line"><span class="comment">/**</div><div class="line">  * Created by gbw on 16-7-13.</div><div class="line">  */</span></div><div class="line"><span class="class"><span class="keyword">object</span> <span class="title">SparkBmpIO</span></span></div><div class="line">&#123;</div><div class="line">	<span class="function"><span class="keyword">def</span> <span class="title">outputGrayMatrix</span></span>(width: <span class="type">Int</span>, height: <span class="type">Int</span>, red : <span class="type">Array</span>[<span class="type">Array</span>[<span class="type">Int</span>]], green : <span class="type">Array</span>[<span class="type">Array</span>[<span class="type">Int</span>]], blue : <span class="type">Array</span>[<span class="type">Array</span>[<span class="type">Int</span>]]): <span class="type">Unit</span> =</div><div class="line">	&#123;</div><div class="line">		<span class="keyword">val</span> matrix = <span class="type">Array</span>.ofDim[<span class="type">Int</span>](width * height, <span class="number">3</span>)</div><div class="line">		<span class="keyword">for</span> (i &lt;- <span class="number">0</span> to height - <span class="number">1</span>)</div><div class="line">			<span class="keyword">for</span> (j &lt;- <span class="number">0</span> to width - <span class="number">1</span>)</div><div class="line">			&#123;</div><div class="line">				matrix(i * width + j)(<span class="number">0</span>) = red(i)(j)</div><div class="line">				matrix(i * width + j)(<span class="number">1</span>) = green(i)(j)</div><div class="line">				matrix(i * width + j)(<span class="number">2</span>) = blue(i)(j)</div><div class="line">			&#125;</div><div class="line">		<span class="keyword">val</span> out = <span class="keyword">new</span> <span class="type">PrintWriter</span>(<span class="string">"/home/gbw/Sparkdata/KmeansBmp/Matrix.txt"</span>)</div><div class="line">		<span class="keyword">for</span> (i &lt;- <span class="number">0</span> to height - <span class="number">1</span>)</div><div class="line">			<span class="keyword">for</span> (j &lt;- <span class="number">0</span> to width - <span class="number">1</span>)</div><div class="line">			&#123;</div><div class="line">				out.print(matrix(i * width + j)(<span class="number">0</span>) + <span class="string">" "</span>)</div><div class="line">				out.print(matrix(i * width + j)(<span class="number">1</span>) + <span class="string">" "</span>)</div><div class="line">				out.print(matrix(i * width + j)(<span class="number">2</span>) + <span class="string">"\n"</span>)</div><div class="line">			&#125;</div><div class="line">		out.flush()</div><div class="line">		out.close()</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">def</span> <span class="title">outputRGBMatrix</span></span>(width: <span class="type">Int</span>, height: <span class="type">Int</span>, red : <span class="type">Array</span>[<span class="type">Array</span>[<span class="type">Int</span>]], green : <span class="type">Array</span>[<span class="type">Array</span>[<span class="type">Int</span>]], blue : <span class="type">Array</span>[<span class="type">Array</span>[<span class="type">Int</span>]]): <span class="type">Unit</span> =</div><div class="line">	&#123;</div><div class="line">		<span class="keyword">val</span> matrixRed = <span class="type">Array</span>.ofDim[<span class="type">Int</span>](width * height)</div><div class="line">		<span class="keyword">val</span> matrixGreen = <span class="type">Array</span>.ofDim[<span class="type">Int</span>](width * height)</div><div class="line">		<span class="keyword">val</span> matrixBlue = <span class="type">Array</span>.ofDim[<span class="type">Int</span>](width * height)</div><div class="line">		<span class="keyword">for</span> (i &lt;- <span class="number">0</span> to height - <span class="number">1</span>)</div><div class="line">			<span class="keyword">for</span> (j &lt;- <span class="number">0</span> to width - <span class="number">1</span>)</div><div class="line">			&#123;</div><div class="line">				matrixRed(i * width + j) = red(i)(j)</div><div class="line">				matrixGreen(i * width + j) = green(i)(j)</div><div class="line">				matrixBlue(i * width + j) = blue(i)(j)</div><div class="line">			&#125;</div><div class="line">		<span class="keyword">val</span> outRed = <span class="keyword">new</span> <span class="type">PrintWriter</span>(<span class="string">"/home/gbw/Sparkdata/KmeansBmp/MatrixRed.txt"</span>)</div><div class="line">		<span class="keyword">val</span> outGreen = <span class="keyword">new</span> <span class="type">PrintWriter</span>(<span class="string">"/home/gbw/Sparkdata/KmeansBmp/MatrixGreen.txt"</span>)</div><div class="line">		<span class="keyword">val</span> outBlue = <span class="keyword">new</span> <span class="type">PrintWriter</span>(<span class="string">"/home/gbw/Sparkdata/KmeansBmp/MatrixBlue.txt"</span>)</div><div class="line">		<span class="keyword">for</span> (i &lt;- <span class="number">0</span> to height - <span class="number">1</span>)</div><div class="line">			<span class="keyword">for</span> (j &lt;- <span class="number">0</span> to width - <span class="number">1</span>)</div><div class="line">			&#123;</div><div class="line">				outRed.print(matrixRed(i * width + j) + <span class="string">"\n"</span>)</div><div class="line">				outGreen.print(matrixGreen(i * width + j) + <span class="string">"\n"</span>)</div><div class="line">				outBlue.print(matrixBlue(i * width + j) + <span class="string">"\n"</span>)</div><div class="line">			&#125;</div><div class="line">		outRed.flush()</div><div class="line">		outRed.close()</div><div class="line">		outGreen.flush()</div><div class="line">		outGreen.close()</div><div class="line">		outBlue.flush()</div><div class="line">		outBlue.close()</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">def</span> <span class="title">ls</span></span>(fileSystem:<span class="type">FileSystem</span>,path:<span class="type">String</span>)=</div><div class="line">	&#123;</div><div class="line">		println(<span class="string">"list path:"</span>+path)</div><div class="line">		<span class="keyword">val</span> fs = fileSystem.listStatus(<span class="keyword">new</span> <span class="type">Path</span>(path))</div><div class="line">		<span class="keyword">val</span> listPath = <span class="type">FileUtil</span>.stat2Paths(fs)</div><div class="line">		<span class="keyword">for</span>( p &lt;- listPath)</div><div class="line">		&#123;</div><div class="line">			println(p)</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>])</div><div class="line">	&#123;</div><div class="line">		<span class="type">Logger</span>.getLogger(<span class="string">"org.apache.spark"</span>).setLevel(<span class="type">Level</span>.<span class="type">WARN</span>)</div><div class="line">		<span class="type">Logger</span>.getLogger(<span class="string">"org.eclipse.jetty.server"</span>).setLevel(<span class="type">Level</span>.<span class="type">OFF</span>)</div><div class="line"></div><div class="line">		<span class="keyword">val</span> conf = <span class="keyword">new</span> <span class="type">SparkConf</span>().setAppName(<span class="string">"BmpIO"</span>).setMaster(<span class="string">"local[*]"</span>)</div><div class="line">		<span class="keyword">val</span> sc = <span class="keyword">new</span> <span class="type">SparkContext</span>(conf)</div><div class="line"></div><div class="line">		<span class="keyword">while</span> (<span class="literal">true</span>)</div><div class="line">		&#123;</div><div class="line">			println(<span class="string">"Please input image url :"</span>)</div><div class="line">			<span class="keyword">val</span> inputUrl = <span class="type">Console</span>.readLine()</div><div class="line">			<span class="keyword">val</span> (width, height, red, green, blue) = <span class="type">BmpIO</span>.readBmp(inputUrl)</div><div class="line">			<span class="keyword">val</span> pos = inputUrl.lastIndexOf(<span class="string">"/"</span>)</div><div class="line">			<span class="keyword">val</span> inputName = inputUrl.substring(pos+<span class="number">1</span>, inputUrl.length<span class="number">-4</span>)</div><div class="line">			<span class="comment">//println(inputName)</span></div><div class="line">			outputGrayMatrix(width, height, red, green, blue)</div><div class="line">			outputRGBMatrix(width, height, red, green, blue)</div><div class="line">			<span class="keyword">val</span> numClusters = <span class="number">8</span></div><div class="line">			<span class="keyword">val</span> numIterations = <span class="number">50</span></div><div class="line">			<span class="keyword">val</span> array = <span class="type">SparkKmeans</span>.doKmeans(sc, <span class="string">"/home/gbw/Sparkdata/KmeansBmp/Matrix.txt"</span>, numClusters, numIterations)</div><div class="line">			<span class="keyword">val</span> arrayRed = <span class="type">SparkKmeans</span>.doKmeans(sc, <span class="string">"/home/gbw/Sparkdata/KmeansBmp/MatrixRed.txt"</span>, numClusters, numIterations)</div><div class="line">			<span class="keyword">val</span> arrayGreen = <span class="type">SparkKmeans</span>.doKmeans(sc, <span class="string">"/home/gbw/Sparkdata/KmeansBmp/MatrixGreen.txt"</span>, numClusters, numIterations)</div><div class="line">			<span class="keyword">val</span> arrayBlue = <span class="type">SparkKmeans</span>.doKmeans(sc, <span class="string">"/home/gbw/Sparkdata/KmeansBmp/MatrixBlue.txt"</span>, numClusters, numIterations)</div><div class="line">			<span class="keyword">for</span> (i &lt;- <span class="number">0</span> to height - <span class="number">1</span>)</div><div class="line">				<span class="keyword">for</span> (j &lt;- <span class="number">0</span> to width - <span class="number">1</span>)</div><div class="line">				&#123;</div><div class="line">					red(i)(j)   = array(i * width + j) * <span class="number">256</span> / numClusters</div><div class="line">					green(i)(j) = array(i * width + j) * <span class="number">256</span> / numClusters</div><div class="line">					blue(i)(j)  = array(i * width + j) * <span class="number">256</span> / numClusters</div><div class="line">				&#125;</div><div class="line">			<span class="type">BmpIO</span>.writeBmp(<span class="string">"/home/gbw/Sparkdata/KmeansBmp/"</span>+ inputName +<span class="string">"-out1.bmp"</span>, red, green, blue)</div><div class="line">			<span class="keyword">for</span> (i &lt;- <span class="number">0</span> to height - <span class="number">1</span>)</div><div class="line">				<span class="keyword">for</span> (j &lt;- <span class="number">0</span> to width - <span class="number">1</span>)</div><div class="line">				&#123;</div><div class="line">					red(i)(j)   = arrayRed(i * width + j) * <span class="number">256</span> / numClusters</div><div class="line">					green(i)(j) = arrayGreen(i * width + j) * <span class="number">256</span> / numClusters</div><div class="line">					blue(i)(j)  = arrayBlue(i * width + j) * <span class="number">256</span> / numClusters</div><div class="line">				&#125;</div><div class="line">			<span class="type">BmpIO</span>.writeBmp(<span class="string">"/home/gbw/Sparkdata/KmeansBmp/"</span>+ inputName +<span class="string">"-out2.bmp"</span>, red, green, blue)</div><div class="line"></div><div class="line">			<span class="keyword">val</span> hdfsconf = <span class="keyword">new</span> <span class="type">Configuration</span>()</div><div class="line">			<span class="keyword">val</span> <span class="type">HDFS</span>=<span class="string">"hdfs://localhost:9000"</span></div><div class="line">			<span class="keyword">val</span> hdfs = <span class="type">FileSystem</span>.get(<span class="type">URI</span>.create(<span class="type">HDFS</span>), hdfsconf)</div><div class="line">			<span class="comment">//ls(hdfs,"/")</span></div><div class="line">			<span class="keyword">val</span> source1 = <span class="keyword">new</span> <span class="type">Path</span>(inputUrl)</div><div class="line">			<span class="keyword">val</span> source2 = <span class="keyword">new</span> <span class="type">Path</span>(<span class="string">"/home/gbw/Sparkdata/KmeansBmp/"</span> + inputName + <span class="string">"-out1.bmp"</span>)</div><div class="line">			<span class="keyword">val</span> source3 = <span class="keyword">new</span> <span class="type">Path</span>(<span class="string">"/home/gbw/Sparkdata/KmeansBmp/"</span> + inputName + <span class="string">"-out2.bmp"</span>)</div><div class="line">			<span class="keyword">val</span> dst = <span class="keyword">new</span> <span class="type">Path</span>(<span class="string">"/gbw/Test"</span>)</div><div class="line">			hdfs.copyFromLocalFile(source1,dst)</div><div class="line">			hdfs.copyFromLocalFile(source2,dst)</div><div class="line">			hdfs.copyFromLocalFile(source3,dst)</div><div class="line"></div><div class="line">			<span class="keyword">val</span> out2 = <span class="keyword">new</span> <span class="type">PrintWriter</span>(<span class="string">"/home/gbw/Sparkdata/KmeansBmp/ImageInfo2.txt"</span>)</div><div class="line"><span class="comment">//			Source.fromFile("/home/gbw/Sparkdata/KmeansBmp/ImageInfo.txt").foreach</span></div><div class="line"><span class="comment">//			&#123;</span></div><div class="line"><span class="comment">//				out2.print</span></div><div class="line"><span class="comment">//			&#125;</span></div><div class="line">			<span class="keyword">val</span> file1 = <span class="type">Source</span>.fromFile(<span class="string">"/home/gbw/Sparkdata/KmeansBmp/ImageInfo.txt"</span>)</div><div class="line">			<span class="keyword">for</span> (line &lt;- file1.getLines)</div><div class="line">			&#123;</div><div class="line">				out2.println(line)</div><div class="line">			&#125;</div><div class="line">			out2.print(inputName + <span class="string">".bmp"</span>)</div><div class="line">			out2.flush()</div><div class="line">			out2.close()</div><div class="line">			<span class="keyword">val</span> out1 = <span class="keyword">new</span> <span class="type">PrintWriter</span>(<span class="string">"/home/gbw/Sparkdata/KmeansBmp/ImageInfo.txt"</span>)</div><div class="line"><span class="comment">//			Source.fromFile("/home/gbw/Sparkdata/KmeansBmp/ImageInfo2.txt").foreach</span></div><div class="line"><span class="comment">//			&#123;</span></div><div class="line"><span class="comment">//				out1.print</span></div><div class="line"><span class="comment">//			&#125;</span></div><div class="line">			<span class="keyword">val</span> file2 = <span class="type">Source</span>.fromFile(<span class="string">"/home/gbw/Sparkdata/KmeansBmp/ImageInfo2.txt"</span>)</div><div class="line">			<span class="keyword">for</span> (line &lt;- file2.getLines)</div><div class="line">			&#123;</div><div class="line">				out1.println(line)</div><div class="line">			&#125;</div><div class="line">			out1.flush()</div><div class="line">			out1.close()</div><div class="line">			<span class="keyword">val</span> source = <span class="keyword">new</span> <span class="type">Path</span>(<span class="string">"/home/gbw/Sparkdata/KmeansBmp/ImageInfo.txt"</span>)</div><div class="line">			hdfs.copyFromLocalFile(source,dst)</div><div class="line"></div><div class="line">			println(<span class="string">"Complete! You can see results at http://localhost:50070/explorer.html#/gbw/Test"</span>)</div><div class="line">			println()</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
          <div class="post-more-link text-center">
            <a class="btn" href="/2016/09/13/Spark-架构实现/#more" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/09/13/DVID-加载高分辨率图片/" itemprop="url">
                  DVID 加载高分辨率图像
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-09-13T19:30:35+08:00" content="2016-09-13">
              2016-09-13
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <ol>
<li>使用 fiji 把老师给的 tif 分成 99 张 png。<br><img src="http://oa4pac8sx.bkt.clouddn.com/8.6_1.png" alt="enter image description here"></li>
<li>由于链接学校的服务器比较不方便,我在我的电脑上面重新搭建 dvid,试着把图片加载进来。dvid 有一个设定就是加载图片最多等待 20s,但是图片大小的原因 20s 可能不太够,没有找到设置的地方,我就分批把图片加载进去了。</li>
<li>这时候发现一个问题就是 dvid 加载图片不是很稳定,连续加载有时候卡死,需要重启服务器才能再次加载。</li>
<li>全部载入后效果如下,基本可以显示出图像。<br><img src="http://oa4pac8sx.bkt.clouddn.com/8.6_2.png" alt="enter image description here"></li>
<li>但是仍存在一些问题,显示图片的范围过大(1600*1600+)的时候,图片的数据没有从服务器加载进来可以看到缩放后才从服务器接收到数据<br><img src="http://oa4pac8sx.bkt.clouddn.com/8.6_3.png" alt="enter image description here"><br><img src="http://oa4pac8sx.bkt.clouddn.com/8.6_4.png" alt="enter image description here"></li>
<li>还有个事就是图片大小是 2000<em>4000 的,但是调用插件显示出的是 4000</em>4000 的,可以看到在向服务器请求 4000 宽度的数据,当然返回的是全黑的块。在浏览器中可以看到显示图片载入的是 2000*4000,没问题,可能是调用插件的时候长宽写的有问题<br><img src="http://oa4pac8sx.bkt.clouddn.com/8.6_5.png" alt="enter image description here"></li>
</ol>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/07/31/Plan-8月/" itemprop="url">
                  Plan(8月)
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-07-31T14:40:42+08:00" content="2016-07-31">
              2016-07-31
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>8.1-8.2 收拾电脑<br>8.3-8.7分布式的知识，看书 + MIT的课程<br>8.8-8.14 Spark 视频教程看完<br>8.15-8.25 毕设Spark后台搞定<br>8.26-8.26 Spark后台挂在服务器上<br>8.27-8.29 搞一个简单前端或者连到dvid-console上<br>8.30-8.31 写报告</p>
<p>加油Go Go Go！！！</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/07/28/7-26-7-28/" itemprop="url">
                  7.26-7.28
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-07-28T13:52:02+08:00" content="2016-07-28">
              2016-07-28
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>学习使用Spark SQL读取hdfs中图片的信息，做一些查询和统计的操作<br>学习使用Spark streaming进行实时的统计计算<br>下一步就是把这些spark的东西整合在一起，写好web服务的接口，和前端交，还有就是把它连接到dvid上。</p>
<p>Spark2.0 前几天刚刚正式发布，据说大幅度提升SQL的功能，MLlib以支持Dataframe的API为主要的API，过两天我就回家了，回家后再试试Spark2.0的新特性，试着把写的子程序整合在Spark2.0的版本上，做好后我再写一个总结报告发给老师。</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> org.apache.spark.&#123;<span class="type">SparkConf</span>, <span class="type">SparkContext</span>&#125;</div><div class="line"><span class="keyword">import</span> org.apache.spark.sql.&#123;<span class="type">Row</span>, <span class="type">SQLContext</span>&#125;</div><div class="line"><span class="keyword">import</span> org.apache.spark.sql.types.&#123;<span class="type">StringType</span>, <span class="type">StructField</span>, <span class="type">StructType</span>, _&#125;</div><div class="line"><span class="keyword">import</span> org.apache.spark.rdd.<span class="type">RDD</span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">object</span> <span class="title">ImageSQL</span></span></div><div class="line">&#123;</div><div class="line">	<span class="comment">//private val schemaString = "id,gender,height"</span></div><div class="line">	<span class="keyword">private</span> <span class="keyword">val</span> schemaString = <span class="string">"name,type,size"</span></div><div class="line">	<span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>])</div><div class="line">	&#123;</div><div class="line">		<span class="keyword">if</span> (args.length &lt; <span class="number">1</span>)</div><div class="line">		&#123;</div><div class="line">			println(<span class="string">"Usage:ImageData filePath"</span>)</div><div class="line">			<span class="type">System</span>.exit(<span class="number">1</span>)</div><div class="line">		&#125;</div><div class="line"></div><div class="line">		<span class="keyword">val</span> conf = <span class="keyword">new</span> <span class="type">SparkConf</span>().setAppName(<span class="string">"Image Data Test"</span>)</div><div class="line">		<span class="keyword">val</span> sc = <span class="keyword">new</span> <span class="type">SparkContext</span>(conf)</div><div class="line">		<span class="keyword">val</span> <span class="type">ImageDataRDD</span> = sc.textFile(args(<span class="number">0</span>))</div><div class="line">		<span class="keyword">val</span> sqlCtx = <span class="keyword">new</span> <span class="type">SQLContext</span>(sc)</div><div class="line"></div><div class="line">		<span class="comment">// this is used to implicitly convert an RDD to a DataFrame.</span></div><div class="line">		<span class="keyword">import</span> sqlCtx.implicits._</div><div class="line">		<span class="keyword">val</span> schemaArray = schemaString.split(<span class="string">","</span>)</div><div class="line">		<span class="keyword">val</span> schema = <span class="type">StructType</span>(schemaArray.map(fieldName =&gt; <span class="type">StructField</span>(fieldName, <span class="type">StringType</span>, <span class="literal">true</span>)))</div><div class="line">		<span class="keyword">val</span> rowRDD: <span class="type">RDD</span>[<span class="type">Row</span>] = <span class="type">ImageDataRDD</span>.map(_.split(<span class="string">" "</span>)).map(eachRow =&gt; <span class="type">Row</span>(eachRow(<span class="number">0</span>), eachRow(<span class="number">1</span>), eachRow(<span class="number">2</span>)))</div><div class="line">		<span class="keyword">val</span> <span class="type">ImageDF</span> = sqlCtx.createDataFrame(rowRDD, schema)</div><div class="line"></div><div class="line">		<span class="type">ImageDF</span>.registerTempTable(<span class="string">"Image"</span>)</div><div class="line">		<span class="keyword">val</span> lagerThan100 = sqlCtx.sql(<span class="string">"select name,type,size from Image where size &gt; 100"</span>)</div><div class="line">		println(<span class="string">"Num of Image &gt; 100kb: "</span> + lagerThan100.count())</div><div class="line">		println(<span class="string">"&lt;Display #1&gt;"</span>)</div><div class="line"></div><div class="line">		<span class="keyword">val</span> bmpLargerThan100 = sqlCtx.sql(<span class="string">"select name,type,size from Image where size &gt; 100 and type='bmp'"</span>)</div><div class="line">		println(<span class="string">"Num of Image &gt; 100kb and type is bmp: "</span> + bmpLargerThan100.count())</div><div class="line">		println(<span class="string">"&lt;Display #2&gt;"</span>)</div><div class="line"></div><div class="line">		<span class="type">ImageDF</span>.groupBy(<span class="type">ImageDF</span>(<span class="string">"type"</span>)).count().show()</div><div class="line">		println(<span class="string">"Image Count Grouped By type"</span>)</div><div class="line">		println(<span class="string">"&lt;Display #3&gt;"</span>)</div><div class="line"></div><div class="line">		<span class="type">ImageDF</span>.filter(<span class="type">ImageDF</span>(<span class="string">"type"</span>).equalTo(<span class="string">"png"</span>)).filter(<span class="type">ImageDF</span>(<span class="string">"size"</span>) &gt; <span class="number">200</span>).show()</div><div class="line">		println(<span class="string">"Png which size is more than 200"</span>)</div><div class="line">		println(<span class="string">"&lt;Display #4&gt;"</span>)</div><div class="line"></div><div class="line"><span class="comment">//		ImageDF.sort($"size".desc).take(2).foreach &#123; row =&gt; println(row(0) + "," + row(1) + "," + row(2)) &#125;</span></div><div class="line"><span class="comment">//		println("Sorted the Image by size in descend order,Show top 2 Image")</span></div><div class="line"><span class="comment">//		println("&lt;Display #5&gt;")</span></div><div class="line"><span class="comment">//</span></div><div class="line"><span class="comment">//		ImageDF.filter(ImageDF("type").equalTo("jpg")).agg(Map("size" -&gt; "avg")).show()</span></div><div class="line"><span class="comment">//		println("The Average size for jpg")</span></div><div class="line"><span class="comment">//		println("&lt;Display #6&gt;")</span></div><div class="line"><span class="comment">//</span></div><div class="line"><span class="comment">//		ImageDF.filter(ImageDF("type").equalTo("bmp")).agg("size" -&gt; "max").show()</span></div><div class="line"><span class="comment">//		println("The Max size of bmp:")</span></div><div class="line"><span class="comment">//		println("&lt;Display #7&gt;")</span></div><div class="line"></div><div class="line">		println(<span class="string">"All the statistics actions are finished on structured Image data."</span>)</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>spark-submit运行</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">./spark-submit --class ImageSQL --master spark://localhost:7077 /home/gbw/Sparkjar/SparkSQLImage.jar hdfs://localhost:9000/gbw/input/Images/Image.txt</div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/07/26/7-24-7-25/" itemprop="url">
                  7.24-7.25
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-07-26T16:17:59+08:00" content="2016-07-26">
              2016-07-26
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Spark SQL<br>配置了mysql hive sparksql</p>
<p>sparksql demo:</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> org.apache.spark.<span class="type">SparkConf</span></div><div class="line"><span class="keyword">import</span> org.apache.spark.<span class="type">SparkContext</span></div><div class="line"><span class="keyword">import</span> org.apache.spark.sql.<span class="type">SQLContext</span></div><div class="line"><span class="keyword">import</span> org.apache.spark.sql.types._</div><div class="line"><span class="keyword">import</span> org.apache.spark.sql.<span class="type">Row</span></div><div class="line"><span class="keyword">import</span> org.apache.spark.rdd.<span class="type">RDD</span></div><div class="line"><span class="class"><span class="keyword">object</span> <span class="title">SQLOnSpark</span> </span>&#123;</div><div class="line">	<span class="keyword">private</span> <span class="keyword">val</span> schemaString = <span class="string">"id,gender,height"</span></div><div class="line">	<span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]) &#123;</div><div class="line">		<span class="keyword">if</span> (args.length &lt; <span class="number">1</span>) &#123;</div><div class="line">			println(<span class="string">"Usage:PeopleDataStatistics2 filePath"</span>)</div><div class="line">			<span class="type">System</span>.exit(<span class="number">1</span>)</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">val</span> conf = <span class="keyword">new</span> <span class="type">SparkConf</span>().setAppName(<span class="string">"Spark Exercise:People Data Statistics 2"</span>)</div><div class="line">		<span class="keyword">val</span> sc = <span class="keyword">new</span> <span class="type">SparkContext</span>(conf)</div><div class="line">		<span class="keyword">val</span> peopleDataRDD = sc.textFile(args(<span class="number">0</span>))</div><div class="line">		<span class="keyword">val</span> sqlCtx = <span class="keyword">new</span> <span class="type">SQLContext</span>(sc)</div><div class="line">		<span class="comment">// this is used to implicitly convert an RDD to a DataFrame.</span></div><div class="line">		<span class="keyword">import</span> sqlCtx.implicits._</div><div class="line">		<span class="keyword">val</span> schemaArray = schemaString.split(<span class="string">","</span>)</div><div class="line">		<span class="keyword">val</span> schema = <span class="type">StructType</span>(schemaArray.map(fieldName =&gt; <span class="type">StructField</span>(fieldName, <span class="type">StringType</span>, <span class="literal">true</span>)))</div><div class="line">		<span class="keyword">val</span> rowRDD: <span class="type">RDD</span>[<span class="type">Row</span>] = peopleDataRDD.map(_.split(<span class="string">" "</span>)).map(</div><div class="line">			eachRow =&gt; <span class="type">Row</span>(eachRow(<span class="number">0</span>), eachRow(<span class="number">1</span>), eachRow(<span class="number">2</span>)))</div><div class="line">		<span class="keyword">val</span> peopleDF = sqlCtx.createDataFrame(rowRDD, schema)</div><div class="line">		peopleDF.registerTempTable(<span class="string">"people"</span>)</div><div class="line">		<span class="comment">//get the male people whose height is more than 180</span></div><div class="line">		<span class="keyword">val</span> higherMale180 = sqlCtx.sql(<span class="string">"select id,gender, height from people where height &gt; 180 and gender='M'"</span>)</div><div class="line">		println(<span class="string">"Men whose height are more than 180: "</span> + higherMale180.count())</div><div class="line">		println(<span class="string">"&lt;Display #1&gt;"</span>)</div><div class="line">		<span class="comment">//get the female people whose height is more than 170</span></div><div class="line">		<span class="keyword">val</span> higherFemale170 = sqlCtx.sql(<span class="string">"select id,gender, height from people where height &gt; 170 and gender='F'"</span>)</div><div class="line">		println(<span class="string">"Women whose height are more than 170: "</span> + higherFemale170.count())</div><div class="line">		println(<span class="string">"&lt;Display #2&gt;"</span>)</div><div class="line">		<span class="comment">//Grouped the people by gender and count the number</span></div><div class="line">		peopleDF.groupBy(peopleDF(<span class="string">"gender"</span>)).count().show()</div><div class="line">		println(<span class="string">"People Count Grouped By Gender"</span>)</div><div class="line">		println(<span class="string">"&lt;Display #3&gt;"</span>)</div><div class="line">		<span class="comment">//</span></div><div class="line">		peopleDF.filter(peopleDF(<span class="string">"gender"</span>).equalTo(<span class="string">"M"</span>)).filter(</div><div class="line">			peopleDF(<span class="string">"height"</span>) &gt; <span class="number">210</span>).show(<span class="number">50</span>)</div><div class="line">		println(<span class="string">"Men whose height is more than 210"</span>)</div><div class="line">		println(<span class="string">"&lt;Display #4&gt;"</span>)</div><div class="line">		<span class="comment">//</span></div><div class="line">		peopleDF.sort($<span class="string">"height"</span>.desc).take(<span class="number">50</span>).foreach &#123; row =&gt; println(row(<span class="number">0</span>) + <span class="string">","</span> + row(<span class="number">1</span>) + <span class="string">","</span> + row(<span class="number">2</span>)) &#125;</div><div class="line">		println(<span class="string">"Sorted the people by height in descend order,Show top 50 people"</span>)</div><div class="line">		println(<span class="string">"&lt;Display #5&gt;"</span>)</div><div class="line">		<span class="comment">//</span></div><div class="line">		peopleDF.filter(peopleDF(<span class="string">"gender"</span>).equalTo(<span class="string">"M"</span>)).agg(<span class="type">Map</span>(<span class="string">"height"</span> -&gt; <span class="string">"avg"</span>)).show()</div><div class="line">		println(<span class="string">"The Average height for Men"</span>)</div><div class="line">		println(<span class="string">"&lt;Display #6&gt;"</span>)</div><div class="line">		<span class="comment">//</span></div><div class="line">		peopleDF.filter(peopleDF(<span class="string">"gender"</span>).equalTo(<span class="string">"F"</span>)).agg(<span class="string">"height"</span> -&gt; <span class="string">"max"</span>).show()</div><div class="line">		println(<span class="string">"The Max height for Women:"</span>)</div><div class="line">		println(<span class="string">"&lt;Display #7&gt;"</span>)</div><div class="line">		<span class="comment">//......</span></div><div class="line">		println(<span class="string">"All the statistics actions are finished on structured People data."</span>)</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>spark-submit 运行</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">./spark-submit --class SQLOnSpark --master spark://localhost:7077 /home/gbw/Sparkjar/SparkSQL.jar hdfs://localhost:9000/gbw/input/peopleSQL.txt</div></pre></td></tr></table></figure>
<p>Spark 的 web UI<br><img src="http://oa4pac8sx.bkt.clouddn.com/2016-07-26%2016:44:10%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE.png" alt="enter image description here"></p>
<p>结果在终端输出的：<br>举个例子：<br>+———–+<br>|max(height)|<br>+———–+<br>|        199|<br>+———–+</p>
<p>The Max height for Women:</p>
<display #7="">






</display>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/07/23/7-22-7-23/" itemprop="url">
                  7.22-7.23
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-07-23T18:25:42+08:00" content="2016-07-23">
              2016-07-23
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>学习<a href="https://github.com/Unknwon/go-fundamental-programming" target="_blank" rel="external">https://github.com/Unknwon/go-fundamental-programming</a><br>golang的基本语法</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/07/23/7-17-7-21/" itemprop="url">
                  7.17-7.21
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-07-23T18:23:30+08:00" content="2016-07-23">
              2016-07-23
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="DVID连接NeuTube"><a href="#DVID连接NeuTube" class="headerlink" title="DVID连接NeuTube"></a>DVID连接NeuTube</h1><p>注册自定义协议处理程序，新建neutube.desktop把参数“neptune://…”传给neutu.desktop，调用脚本neutu.sh，处理掉“neptune://”，取到实际图片的地址，传到neuTube里面打开</p>
<p>1./usr/share/applications/defaults.list<br>增加x-scheme-handler/neutu=neutu.desktop</p>
<p>2./usr/share/applications/新建neutudesktop</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">[Desktop Entry]</div><div class="line">Name = neutu</div><div class="line">Exec = neutu.sh %u</div><div class="line">Type = Application</div></pre></td></tr></table></figure>
<p>3.neuTube 执行文件放到/usr/bin</p>
<p>4./usr/新建neutu.sh</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#!/bin/sh</span></div><div class="line">	STR = <span class="variable">$1</span></div><div class="line">	STR = <span class="variable">$&#123;STR##neutu:\/\/&#125;</span></div><div class="line">	neuTube <span class="variable">$STR</span></div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel  sidebar-panel-active ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="http://oa4pac8sx.bkt.clouddn.com/u=4284545010,775528643&fm=21&gp=0.jpg"
               alt="GBW" />
          <p class="site-author-name" itemprop="name">GBW</p>
          <p class="site-description motion-element" itemprop="description">Scala,Spark</p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">27</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">6</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/GBWen" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://blog.sina.com.cn/u/5660562931" target="_blank" title="曾经博客">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                  曾经博客
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://user.qzone.qq.com/376366210" target="_blank" title="QQ空间">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                  QQ空间
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://www.zhihu.com/people/guan-bo-wen-98" target="_blank" title="知乎">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                  知乎
                </a>
              </span>
            
          
        </div>

        
        

        
        

      </section>

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2016</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">GBW</span>
</div>

<div class="powered-by">
  由 <a class="theme-link" href="http://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Pisces
  </a>
</div>

        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.0.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.0.1"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.0.1"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.0.1"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.0.1"></script>



  



  




  
  

  

  

  

</body>
</html>
