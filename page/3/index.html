<!doctype html>



  


<html class="theme-next pisces use-motion">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
  <link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  
    
      
    

    
  

  

  
    
      
    

    
  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic|Roboto Slab:300,300italic,400,400italic,700,700italic|Lobster Two:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.0.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.0.1" />






<meta name="description" content="Scala,Spark">
<meta property="og:type" content="website">
<meta property="og:title" content="GBW's Blog">
<meta property="og:url" content="http://yoursite.com/page/3/index.html">
<meta property="og:site_name" content="GBW's Blog">
<meta property="og:description" content="Scala,Spark">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="GBW's Blog">
<meta name="twitter:description" content="Scala,Spark">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: 0,
      author: '博主'
    }
  };
</script>




  <link rel="canonical" href="http://yoursite.com/page/3/"/>

  <title> GBW's Blog </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  










  
  
    
  

  <div class="container one-collumn sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">GBW's Blog</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle">Write 1000 Lines a Day to Change My Life!  ٩( 'ω' )و</p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-books">
          <a href="/books" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-heartbeat"></i> <br />
            
            书单
          </a>
        </li>
      
        
        <li class="menu-item menu-item-reviews">
          <a href="/reviews" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-heartbeat"></i> <br />
            
            评测
          </a>
        </li>
      
        
        <li class="menu-item menu-item-bodybuilding">
          <a href="/bodybuilding" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-heartbeat"></i> <br />
            
            健身
          </a>
        </li>
      

      
    </ul>
  

  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/07/31/Plan-8月/" itemprop="url">
                  Plan(8月)
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-07-31T14:40:42+08:00" content="2016-07-31">
              2016-07-31
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>8.1-8.2 收拾电脑<br>8.3-8.7分布式的知识，看书 + MIT的课程<br>8.8-8.14 Spark 视频教程看完<br>8.15-8.25 毕设Spark后台搞定<br>8.26-8.26 Spark后台挂在服务器上<br>8.27-8.29 搞一个简单前端或者连到dvid-console上<br>8.30-8.31 写报告</p>
<p>加油Go Go Go！！！</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/07/28/7-26-7-28/" itemprop="url">
                  7.26-7.28
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-07-28T13:52:02+08:00" content="2016-07-28">
              2016-07-28
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>学习使用Spark SQL读取hdfs中图片的信息，做一些查询和统计的操作<br>学习使用Spark streaming进行实时的统计计算<br>下一步就是把这些spark的东西整合在一起，写好web服务的接口，和前端交，还有就是把它连接到dvid上。</p>
<p>Spark2.0 前几天刚刚正式发布，据说大幅度提升SQL的功能，MLlib以支持Dataframe的API为主要的API，过两天我就回家了，回家后再试试Spark2.0的新特性，试着把写的子程序整合在Spark2.0的版本上，做好后我再写一个总结报告发给老师。</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> org.apache.spark.&#123;<span class="type">SparkConf</span>, <span class="type">SparkContext</span>&#125;</div><div class="line"><span class="keyword">import</span> org.apache.spark.sql.&#123;<span class="type">Row</span>, <span class="type">SQLContext</span>&#125;</div><div class="line"><span class="keyword">import</span> org.apache.spark.sql.types.&#123;<span class="type">StringType</span>, <span class="type">StructField</span>, <span class="type">StructType</span>, _&#125;</div><div class="line"><span class="keyword">import</span> org.apache.spark.rdd.<span class="type">RDD</span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">object</span> <span class="title">ImageSQL</span></span></div><div class="line">&#123;</div><div class="line">	<span class="comment">//private val schemaString = "id,gender,height"</span></div><div class="line">	<span class="keyword">private</span> <span class="keyword">val</span> schemaString = <span class="string">"name,type,size"</span></div><div class="line">	<span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>])</div><div class="line">	&#123;</div><div class="line">		<span class="keyword">if</span> (args.length &lt; <span class="number">1</span>)</div><div class="line">		&#123;</div><div class="line">			println(<span class="string">"Usage:ImageData filePath"</span>)</div><div class="line">			<span class="type">System</span>.exit(<span class="number">1</span>)</div><div class="line">		&#125;</div><div class="line"></div><div class="line">		<span class="keyword">val</span> conf = <span class="keyword">new</span> <span class="type">SparkConf</span>().setAppName(<span class="string">"Image Data Test"</span>)</div><div class="line">		<span class="keyword">val</span> sc = <span class="keyword">new</span> <span class="type">SparkContext</span>(conf)</div><div class="line">		<span class="keyword">val</span> <span class="type">ImageDataRDD</span> = sc.textFile(args(<span class="number">0</span>))</div><div class="line">		<span class="keyword">val</span> sqlCtx = <span class="keyword">new</span> <span class="type">SQLContext</span>(sc)</div><div class="line"></div><div class="line">		<span class="comment">// this is used to implicitly convert an RDD to a DataFrame.</span></div><div class="line">		<span class="keyword">import</span> sqlCtx.implicits._</div><div class="line">		<span class="keyword">val</span> schemaArray = schemaString.split(<span class="string">","</span>)</div><div class="line">		<span class="keyword">val</span> schema = <span class="type">StructType</span>(schemaArray.map(fieldName =&gt; <span class="type">StructField</span>(fieldName, <span class="type">StringType</span>, <span class="literal">true</span>)))</div><div class="line">		<span class="keyword">val</span> rowRDD: <span class="type">RDD</span>[<span class="type">Row</span>] = <span class="type">ImageDataRDD</span>.map(_.split(<span class="string">" "</span>)).map(eachRow =&gt; <span class="type">Row</span>(eachRow(<span class="number">0</span>), eachRow(<span class="number">1</span>), eachRow(<span class="number">2</span>)))</div><div class="line">		<span class="keyword">val</span> <span class="type">ImageDF</span> = sqlCtx.createDataFrame(rowRDD, schema)</div><div class="line"></div><div class="line">		<span class="type">ImageDF</span>.registerTempTable(<span class="string">"Image"</span>)</div><div class="line">		<span class="keyword">val</span> lagerThan100 = sqlCtx.sql(<span class="string">"select name,type,size from Image where size &gt; 100"</span>)</div><div class="line">		println(<span class="string">"Num of Image &gt; 100kb: "</span> + lagerThan100.count())</div><div class="line">		println(<span class="string">"&lt;Display #1&gt;"</span>)</div><div class="line"></div><div class="line">		<span class="keyword">val</span> bmpLargerThan100 = sqlCtx.sql(<span class="string">"select name,type,size from Image where size &gt; 100 and type='bmp'"</span>)</div><div class="line">		println(<span class="string">"Num of Image &gt; 100kb and type is bmp: "</span> + bmpLargerThan100.count())</div><div class="line">		println(<span class="string">"&lt;Display #2&gt;"</span>)</div><div class="line"></div><div class="line">		<span class="type">ImageDF</span>.groupBy(<span class="type">ImageDF</span>(<span class="string">"type"</span>)).count().show()</div><div class="line">		println(<span class="string">"Image Count Grouped By type"</span>)</div><div class="line">		println(<span class="string">"&lt;Display #3&gt;"</span>)</div><div class="line"></div><div class="line">		<span class="type">ImageDF</span>.filter(<span class="type">ImageDF</span>(<span class="string">"type"</span>).equalTo(<span class="string">"png"</span>)).filter(<span class="type">ImageDF</span>(<span class="string">"size"</span>) &gt; <span class="number">200</span>).show()</div><div class="line">		println(<span class="string">"Png which size is more than 200"</span>)</div><div class="line">		println(<span class="string">"&lt;Display #4&gt;"</span>)</div><div class="line"></div><div class="line"><span class="comment">//		ImageDF.sort($"size".desc).take(2).foreach &#123; row =&gt; println(row(0) + "," + row(1) + "," + row(2)) &#125;</span></div><div class="line"><span class="comment">//		println("Sorted the Image by size in descend order,Show top 2 Image")</span></div><div class="line"><span class="comment">//		println("&lt;Display #5&gt;")</span></div><div class="line"><span class="comment">//</span></div><div class="line"><span class="comment">//		ImageDF.filter(ImageDF("type").equalTo("jpg")).agg(Map("size" -&gt; "avg")).show()</span></div><div class="line"><span class="comment">//		println("The Average size for jpg")</span></div><div class="line"><span class="comment">//		println("&lt;Display #6&gt;")</span></div><div class="line"><span class="comment">//</span></div><div class="line"><span class="comment">//		ImageDF.filter(ImageDF("type").equalTo("bmp")).agg("size" -&gt; "max").show()</span></div><div class="line"><span class="comment">//		println("The Max size of bmp:")</span></div><div class="line"><span class="comment">//		println("&lt;Display #7&gt;")</span></div><div class="line"></div><div class="line">		println(<span class="string">"All the statistics actions are finished on structured Image data."</span>)</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>spark-submit运行</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">./spark-submit --class ImageSQL --master spark://localhost:7077 /home/gbw/Sparkjar/SparkSQLImage.jar hdfs://localhost:9000/gbw/input/Images/Image.txt</div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/07/26/7-24-7-25/" itemprop="url">
                  7.24-7.25
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-07-26T16:17:59+08:00" content="2016-07-26">
              2016-07-26
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Spark SQL<br>配置了mysql hive sparksql</p>
<p>sparksql demo:</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> org.apache.spark.<span class="type">SparkConf</span></div><div class="line"><span class="keyword">import</span> org.apache.spark.<span class="type">SparkContext</span></div><div class="line"><span class="keyword">import</span> org.apache.spark.sql.<span class="type">SQLContext</span></div><div class="line"><span class="keyword">import</span> org.apache.spark.sql.types._</div><div class="line"><span class="keyword">import</span> org.apache.spark.sql.<span class="type">Row</span></div><div class="line"><span class="keyword">import</span> org.apache.spark.rdd.<span class="type">RDD</span></div><div class="line"><span class="class"><span class="keyword">object</span> <span class="title">SQLOnSpark</span> </span>&#123;</div><div class="line">	<span class="keyword">private</span> <span class="keyword">val</span> schemaString = <span class="string">"id,gender,height"</span></div><div class="line">	<span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]) &#123;</div><div class="line">		<span class="keyword">if</span> (args.length &lt; <span class="number">1</span>) &#123;</div><div class="line">			println(<span class="string">"Usage:PeopleDataStatistics2 filePath"</span>)</div><div class="line">			<span class="type">System</span>.exit(<span class="number">1</span>)</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">val</span> conf = <span class="keyword">new</span> <span class="type">SparkConf</span>().setAppName(<span class="string">"Spark Exercise:People Data Statistics 2"</span>)</div><div class="line">		<span class="keyword">val</span> sc = <span class="keyword">new</span> <span class="type">SparkContext</span>(conf)</div><div class="line">		<span class="keyword">val</span> peopleDataRDD = sc.textFile(args(<span class="number">0</span>))</div><div class="line">		<span class="keyword">val</span> sqlCtx = <span class="keyword">new</span> <span class="type">SQLContext</span>(sc)</div><div class="line">		<span class="comment">// this is used to implicitly convert an RDD to a DataFrame.</span></div><div class="line">		<span class="keyword">import</span> sqlCtx.implicits._</div><div class="line">		<span class="keyword">val</span> schemaArray = schemaString.split(<span class="string">","</span>)</div><div class="line">		<span class="keyword">val</span> schema = <span class="type">StructType</span>(schemaArray.map(fieldName =&gt; <span class="type">StructField</span>(fieldName, <span class="type">StringType</span>, <span class="literal">true</span>)))</div><div class="line">		<span class="keyword">val</span> rowRDD: <span class="type">RDD</span>[<span class="type">Row</span>] = peopleDataRDD.map(_.split(<span class="string">" "</span>)).map(</div><div class="line">			eachRow =&gt; <span class="type">Row</span>(eachRow(<span class="number">0</span>), eachRow(<span class="number">1</span>), eachRow(<span class="number">2</span>)))</div><div class="line">		<span class="keyword">val</span> peopleDF = sqlCtx.createDataFrame(rowRDD, schema)</div><div class="line">		peopleDF.registerTempTable(<span class="string">"people"</span>)</div><div class="line">		<span class="comment">//get the male people whose height is more than 180</span></div><div class="line">		<span class="keyword">val</span> higherMale180 = sqlCtx.sql(<span class="string">"select id,gender, height from people where height &gt; 180 and gender='M'"</span>)</div><div class="line">		println(<span class="string">"Men whose height are more than 180: "</span> + higherMale180.count())</div><div class="line">		println(<span class="string">"&lt;Display #1&gt;"</span>)</div><div class="line">		<span class="comment">//get the female people whose height is more than 170</span></div><div class="line">		<span class="keyword">val</span> higherFemale170 = sqlCtx.sql(<span class="string">"select id,gender, height from people where height &gt; 170 and gender='F'"</span>)</div><div class="line">		println(<span class="string">"Women whose height are more than 170: "</span> + higherFemale170.count())</div><div class="line">		println(<span class="string">"&lt;Display #2&gt;"</span>)</div><div class="line">		<span class="comment">//Grouped the people by gender and count the number</span></div><div class="line">		peopleDF.groupBy(peopleDF(<span class="string">"gender"</span>)).count().show()</div><div class="line">		println(<span class="string">"People Count Grouped By Gender"</span>)</div><div class="line">		println(<span class="string">"&lt;Display #3&gt;"</span>)</div><div class="line">		<span class="comment">//</span></div><div class="line">		peopleDF.filter(peopleDF(<span class="string">"gender"</span>).equalTo(<span class="string">"M"</span>)).filter(</div><div class="line">			peopleDF(<span class="string">"height"</span>) &gt; <span class="number">210</span>).show(<span class="number">50</span>)</div><div class="line">		println(<span class="string">"Men whose height is more than 210"</span>)</div><div class="line">		println(<span class="string">"&lt;Display #4&gt;"</span>)</div><div class="line">		<span class="comment">//</span></div><div class="line">		peopleDF.sort($<span class="string">"height"</span>.desc).take(<span class="number">50</span>).foreach &#123; row =&gt; println(row(<span class="number">0</span>) + <span class="string">","</span> + row(<span class="number">1</span>) + <span class="string">","</span> + row(<span class="number">2</span>)) &#125;</div><div class="line">		println(<span class="string">"Sorted the people by height in descend order,Show top 50 people"</span>)</div><div class="line">		println(<span class="string">"&lt;Display #5&gt;"</span>)</div><div class="line">		<span class="comment">//</span></div><div class="line">		peopleDF.filter(peopleDF(<span class="string">"gender"</span>).equalTo(<span class="string">"M"</span>)).agg(<span class="type">Map</span>(<span class="string">"height"</span> -&gt; <span class="string">"avg"</span>)).show()</div><div class="line">		println(<span class="string">"The Average height for Men"</span>)</div><div class="line">		println(<span class="string">"&lt;Display #6&gt;"</span>)</div><div class="line">		<span class="comment">//</span></div><div class="line">		peopleDF.filter(peopleDF(<span class="string">"gender"</span>).equalTo(<span class="string">"F"</span>)).agg(<span class="string">"height"</span> -&gt; <span class="string">"max"</span>).show()</div><div class="line">		println(<span class="string">"The Max height for Women:"</span>)</div><div class="line">		println(<span class="string">"&lt;Display #7&gt;"</span>)</div><div class="line">		<span class="comment">//......</span></div><div class="line">		println(<span class="string">"All the statistics actions are finished on structured People data."</span>)</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>spark-submit 运行</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">./spark-submit --class SQLOnSpark --master spark://localhost:7077 /home/gbw/Sparkjar/SparkSQL.jar hdfs://localhost:9000/gbw/input/peopleSQL.txt</div></pre></td></tr></table></figure>
<p>Spark 的 web UI<br><img src="http://oa4pac8sx.bkt.clouddn.com/2016-07-26%2016:44:10%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE.png" alt="enter image description here"></p>
<p>结果在终端输出的：<br>举个例子：<br>+———–+<br>|max(height)|<br>+———–+<br>|        199|<br>+———–+</p>
<p>The Max height for Women:</p>
<display #7="">






</display>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/07/23/7-22-7-23/" itemprop="url">
                  7.22-7.23
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-07-23T18:25:42+08:00" content="2016-07-23">
              2016-07-23
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>学习<a href="https://github.com/Unknwon/go-fundamental-programming" target="_blank" rel="external">https://github.com/Unknwon/go-fundamental-programming</a><br>golang的基本语法</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/07/23/7-17-7-21/" itemprop="url">
                  7.17-7.21
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-07-23T18:23:30+08:00" content="2016-07-23">
              2016-07-23
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="DVID连接NeuTube"><a href="#DVID连接NeuTube" class="headerlink" title="DVID连接NeuTube"></a>DVID连接NeuTube</h1><p>注册自定义协议处理程序，新建neutube.desktop把参数“neptune://…”传给neutu.desktop，调用脚本neutu.sh，处理掉“neptune://”，取到实际图片的地址，传到neuTube里面打开</p>
<p>1./usr/share/applications/defaults.list<br>增加x-scheme-handler/neutu=neutu.desktop</p>
<p>2./usr/share/applications/新建neutudesktop</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">[Desktop Entry]</div><div class="line">Name = neutu</div><div class="line">Exec = neutu.sh %u</div><div class="line">Type = Application</div></pre></td></tr></table></figure>
<p>3.neuTube 执行文件放到/usr/bin</p>
<p>4./usr/新建neutu.sh</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#!/bin/sh</span></div><div class="line">	STR = <span class="variable">$1</span></div><div class="line">	STR = <span class="variable">$&#123;STR##neutu:\/\/&#125;</span></div><div class="line">	neuTube <span class="variable">$STR</span></div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/07/16/7-16/" itemprop="url">
                  7.16
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-07-16T19:14:47+08:00" content="2016-07-16">
              2016-07-16
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <p>Spark GraphX 是一个分布式图处理框架,它是基于 Spark 平台提供对图计算和图挖掘简洁<br>易用的而丰富的接口,极大的方便了对分布式图处理的需求。<br>这里写了个PageRank算法的例子<br>PageRank算法计算每一个网页的PageRank值，然后根据这个值的大小对网页的重要性进行排序。它的思想是模拟一个悠闲的上网者，上网者首先随机选择一个网页打开，然后在这个网页上呆了几分钟后，跳转到该网页所指向的链接，这样无所事事、漫无目的地在网页上跳来跳去，PageRank就是估计这个悠闲的上网者分布在各个网页上的概率。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">import org.apache.log4j.&#123;Level, Logger&#125;</div><div class="line">import org.apache.spark.&#123;SparkContext, SparkConf&#125;</div><div class="line">import org.apache.spark.graphx._</div><div class="line"></div><div class="line">/**</div><div class="line">  * Created by gbw on 16-7-16.</div><div class="line">  */</div><div class="line"></div><div class="line"></div><div class="line">import org.apache.spark.rdd.RDD</div><div class="line">object PageRank</div><div class="line">&#123;</div><div class="line">	def main(args: Array[String])</div><div class="line">	&#123;</div><div class="line">		//屏蔽日志</div><div class="line">		Logger.getLogger(&quot;org.apache.spark&quot;).setLevel(Level.WARN)</div><div class="line">		Logger.getLogger(&quot;org.eclipse.jetty.server&quot;).setLevel(Level.OFF)</div><div class="line"></div><div class="line">		//设置运行环境</div><div class="line">		val conf = new SparkConf().setAppName(&quot;PageRank&quot;).setMaster(&quot;local&quot;)</div><div class="line">		val sc = new SparkContext(conf)</div><div class="line"></div><div class="line">		//读入数据文件</div><div class="line">		val articles: RDD[String] =</div><div class="line">			sc.textFile(&quot;/home/gbw/Sparkdata/graphx/graphx-wiki-vertices.txt&quot;)</div><div class="line">		val links: RDD[String] =</div><div class="line">			sc.textFile(&quot;/home/gbw/Sparkdata/graphx/graphx-wiki-edges.txt&quot;)</div><div class="line"></div><div class="line">		//装载顶点和边</div><div class="line">		val vertices = articles.map</div><div class="line">		&#123;</div><div class="line">			line =&gt;</div><div class="line">				val fields = line.split(&apos;\t&apos;)</div><div class="line">				(fields(0).toLong, fields(1))</div><div class="line">		&#125;</div><div class="line">		val edges = links.map</div><div class="line">		&#123;</div><div class="line">			line =&gt;</div><div class="line">				val fields = line.split(&apos;\t&apos;)</div><div class="line">				Edge(fields(0).toLong, fields(1).toLong, 0)</div><div class="line">		&#125;</div><div class="line"></div><div class="line">		//cache 操作</div><div class="line">		//val graph = Graph(vertices, edges, &quot;&quot;).persist(StorageLevel.MEMORY_ONLY_SER)</div><div class="line">		val graph = Graph(vertices, edges, &quot;&quot;).persist()</div><div class="line"></div><div class="line">		//测试</div><div class="line">		println(&quot;**********************************************************&quot;)</div><div class="line">		println(&quot;获取 5 个 triplet 信息&quot;)</div><div class="line">		println(&quot;**********************************************************&quot;)</div><div class="line">		graph.triplets.take(5).foreach(println(_))</div><div class="line"></div><div class="line">		//pageRank 算法里面的时候使用了 cache(),故前面 persist 的时候只能使用MEMORY_ONLY</div><div class="line">		println(&quot;**********************************************************&quot;)</div><div class="line">		println(&quot;PageRank 计算,获取最有价值的数据&quot;)</div><div class="line">		println(&quot;**********************************************************&quot;)</div><div class="line"></div><div class="line">		val prGraph = graph.pageRank(0.001).cache()</div><div class="line">		val titleAndPrGraph = graph.outerJoinVertices(prGraph.vertices)</div><div class="line">		&#123;</div><div class="line">			(v, title, rank) =&gt; (rank.getOrElse(0.0), title)</div><div class="line">		&#125;</div><div class="line"></div><div class="line">		titleAndPrGraph.vertices.top(10)</div><div class="line">		&#123;</div><div class="line">			Ordering.by((entry: (VertexId, (Double, String))) =&gt; entry._2._1)</div><div class="line">		&#125;.foreach(t =&gt; println(t._2._2 + &quot;: &quot; + t._2._1))</div><div class="line"></div><div class="line">		sc.stop()</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>输出：</p>
          <div class="post-more-link text-center">
            <a class="btn" href="/2016/07/16/7-16/#more" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/07/16/系统架构2/" itemprop="url">
                  系统架构2
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-07-16T19:04:45+08:00" content="2016-07-16">
              2016-07-16
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="系统架构2"><a href="#系统架构2" class="headerlink" title="系统架构2"></a>系统架构2</h1><p>我们需要两种形式的基本要求：<br>1.随着实时数据流的建模<br>2.大批量数据分析建模</p>
<h2 id="Spark架构思路"><a href="#Spark架构思路" class="headerlink" title="Spark架构思路"></a>Spark架构思路</h2><p>采用混合架构模式：Lambda Architecture，其主要提供三个层次：批量处理层(Batch Layer)、服务层(Serving Layer)、速度层(Speed Layer)<br>在批量处理层，选用Spark，其基于内存的特点使得它更适合大量迭代的机器学习和复杂的数据处理，而且在Spark平台是开发的GraphX（图计算框架）和MLlib（机器学习库）都可以直接用于批量的数据分析，极大的方便了应用程序的开发和维护。<br>服务层可以利用SparkSQL等索引服务针对批量处理层的结果进行索引，接受外部查询请求，完成SQL查询任务。<br>速度层采用分布式的流处理平台Spark Streaming，作为批量处理层高延迟响应的补充，可实时计算数据完成处理。<br><img src="http://oa4pac8sx.bkt.clouddn.com/Lambda.png" alt="enter image description here"></p>
<h2 id="平台整体架构"><a href="#平台整体架构" class="headerlink" title="平台整体架构"></a>平台整体架构</h2><p>重点关注Spark平台机器学习算法的实现，设计目标是应对高分辨率图像数据下机器学习任务的挑战，同时适应流数据的特点，基于Spark Streaming 框架上设计在线机器学习算法。<br>底层为Spark平台的基础设施，上层为设计和实现机器学习算法的框架层，其中部分算法依赖GraphX和Saprk Streaming框架，在框架层之上是Web服务接口层，主要封装各个算法的操作和调用接口，以Web Service的忌口方式暴露给外部使用，提供发送请求。<br><img src="http://oa4pac8sx.bkt.clouddn.com/architecture2.png" alt="enter image description here"></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/07/15/7-15/" itemprop="url">
                  7-15
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-07-15T18:46:38+08:00" content="2016-07-15">
              2016-07-15
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>新买的键盘到了，有瑕疵，但敲着确实爽<br>今天写了个MLlib的线性回归，很简单的例子</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> org.apache.log4j.&#123;<span class="type">Level</span>, <span class="type">Logger</span>&#125;</div><div class="line"><span class="keyword">import</span> org.apache.spark.&#123;<span class="type">SparkContext</span>, <span class="type">SparkConf</span>&#125;</div><div class="line"><span class="keyword">import</span> org.apache.spark.mllib.regression.<span class="type">LinearRegressionWithSGD</span></div><div class="line"><span class="keyword">import</span> org.apache.spark.mllib.regression.<span class="type">LabeledPoint</span></div><div class="line"><span class="keyword">import</span> org.apache.spark.mllib.linalg.<span class="type">Vectors</span></div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line">  * Created by gbw on 16-7-15.</div><div class="line">  */</div><div class="line"><span class="class"><span class="keyword">object</span> <span class="title">LinearRegression</span></span></div><div class="line">&#123;</div><div class="line">	<span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> =</div><div class="line">	&#123;</div><div class="line">		<span class="comment">//屏蔽log</span></div><div class="line">		<span class="type">Logger</span>.getLogger(<span class="string">"org.apache.spark"</span>).setLevel(<span class="type">Level</span>.<span class="type">ERROR</span>)</div><div class="line"></div><div class="line">		<span class="comment">//设置运行环境</span></div><div class="line">		<span class="keyword">val</span> conf = <span class="keyword">new</span> <span class="type">SparkConf</span>().setAppName(<span class="string">"Linear Regression"</span>).setMaster(<span class="string">"local[4]"</span>)</div><div class="line">		<span class="keyword">val</span> sc = <span class="keyword">new</span> <span class="type">SparkContext</span>(conf)</div><div class="line"></div><div class="line">		<span class="comment">//Load and parse the data</span></div><div class="line">		<span class="keyword">val</span> data = sc.textFile(<span class="string">"/home/gbw/Sparkdata/Regression/lpsa.data"</span>)</div><div class="line">		<span class="keyword">val</span> parsedData = data.map</div><div class="line">		&#123;</div><div class="line">			line =&gt;</div><div class="line">				<span class="keyword">val</span> parts = line.split(',')</div><div class="line">				<span class="type">LabeledPoint</span>(parts(<span class="number">0</span>).toDouble,<span class="type">Vectors</span>.dense(parts(<span class="number">1</span>).split(' ').map(_.toDouble)))</div><div class="line">		&#125;</div><div class="line"></div><div class="line">		<span class="comment">//Building the model</span></div><div class="line">		<span class="keyword">val</span> numIterations = <span class="number">100</span></div><div class="line">		<span class="keyword">val</span> model = <span class="type">LinearRegressionWithSGD</span>.train(parsedData, numIterations)</div><div class="line"></div><div class="line">		<span class="comment">//Evaluate model on training examples and compute training error</span></div><div class="line">		<span class="keyword">val</span> valuesAndPreds = parsedData.map</div><div class="line">		&#123;</div><div class="line">			point =&gt;</div><div class="line">				<span class="keyword">val</span> prediction = model.predict(point.features)</div><div class="line">				(point.label, prediction)</div><div class="line">		&#125;</div><div class="line"></div><div class="line">		<span class="keyword">val</span> <span class="type">MSE</span> = valuesAndPreds.map</div><div class="line">		&#123;</div><div class="line">			<span class="keyword">case</span>(v,p) =&gt;</div><div class="line">				math.pow((v-p),<span class="number">2</span>)</div><div class="line">		&#125;.reduce(_+_)/valuesAndPreds.count</div><div class="line">		println(<span class="string">"Training Mean Squared Error = "</span> +<span class="type">MSE</span>)</div><div class="line"></div><div class="line">		sc.stop()</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/07/14/系统架构-1/" itemprop="url">
                  系统架构(1) 
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-07-14T10:53:05+08:00" content="2016-07-14">
              2016-07-14
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="系统架构"><a href="#系统架构" class="headerlink" title="系统架构"></a>系统架构</h1><p>最近学习了Spark及其生态圈的一些介绍，他的功能很强大，而且通用性很强，感觉使用这一套东西就可以达到我们的要求，而且开发和维护上会方便很多。<br><img src="http://oa4pac8sx.bkt.clouddn.com/overall.png" alt="enter image description here"></p>
<h2 id="数据存储，资源调度"><a href="#数据存储，资源调度" class="headerlink" title="数据存储，资源调度"></a>数据存储，资源调度</h2><p>数据持久化存储在HDFS上，在最底层的分布式文件存储和上层的各种计算框架之间使用中间件Tachyon，将那些不需要落地到HDFS里的文件落地到分布式内存文件系统中来达到共享内存，从而提高效率。以 Standalone或YARN为资源管理器调度 Job 完成 Spark 应用程序的计算。</p>
<h2 id="计算引擎"><a href="#计算引擎" class="headerlink" title="计算引擎"></a>计算引擎</h2><p>以 Spark Core提供的内存计算框架为核心， 使用Spark Streaming做实时处理应用， 监听对应Socket端口，当有图像处理请求时读取图片，调用基于MLlib的机器学习方法库，对图片进行处理后存储回文件系统，显示到客户端上。使用Spark SQL做及时查询。</p>
<h2 id="Tachyno"><a href="#Tachyno" class="headerlink" title="Tachyno"></a>Tachyno</h2><p>使用Tachyon这一分布式内存文件系统,可以在集群里以访问内存的速度来访问存在Tachyon里的文件。Tachyon是架构在最底层的分布式文件存储和上层的各种<br>计算框架之间的一种中间件,其主要职责是将那些不需要落地到DFS里的文件落地到分布式内存文件系统中来达到共享内存,从而提高效率。同时可以减少内存冗余、GC时间等</p>
<p>Tachyon 在 Spark 平台的部署：总的来说，Tachyon 有三个主要的部件：Master， Client，与 Worker。在每个 Spark Worker 节点上，都部署了一个 Tachyon Worker，Spark Worker 通过 Tachyon Client 访问 Tachyon 进行数据读写。所有的 Tachyon Worker 都被 Tachyon Master所管理，Tachyon Master 通过 Tachyon Worker 定时发出的心跳来判断 Worker 是否已经崩溃以及每个 Worker 剩余的内存空间量。<br><img src="http://oa4pac8sx.bkt.clouddn.com/tachyon.jpg" alt="enter image description here"></p>
<h2 id="Standalone"><a href="#Standalone" class="headerlink" title="Standalone"></a>Standalone</h2><ol>
<li>SparkContext 连接到 Master，向 Master 注册并申请资源（CPU Core 和 Memory）；</li>
<li>Master根据 SparkContext的资源申请要求和 Worker心跳周期内报告的信息决定在哪个Worker 上分配资源，然后在该 Worker 上获取资源，然后启动StandaloneExecutorBackend；</li>
<li>StandaloneExecutorBackend 向 SparkContext 注册；</li>
<li>SparkContext 将 Applicaiton 代码发送给 StandaloneExecutorBackend；并且<br>SparkContext 解析 Applicaiton 代码，构建 DAG 图，并提交给 DAG Scheduler 分解成<br>Stage（当碰到 Action 操作时，就会催生 Job；每个 Job 中含有 1 个或多个 Stage，Stage一般在获取外部数据和 shuffle 之前产生），然后以 Stage（或者称为 TaskSet）提交给Task Scheduler，Task Scheduler 负责将 Task 分配到相应的 Worker，最后提交给<br>StandaloneExecutorBackend 执行；</li>
<li>StandaloneExecutorBackend 会建立 Executor 线程池，开始执行 Task，并向<br>SparkContext 报告，直至 Task 完成。</li>
<li>所有 Task 完成后，SparkContext 向 Master 注销，释放资源。<br><img src="http://oa4pac8sx.bkt.clouddn.com/standalone.png" alt="enter image description here"></li>
</ol>
<h2 id="Spark-Core"><a href="#Spark-Core" class="headerlink" title="Spark Core"></a>Spark Core</h2><ol>
<li>构建 Spark Application 的运行环境(启动 SparkContext),SparkContext 向资源管理器(可以是 Standalone、Mesos 或 YARN)注册并申请运行 Executor 资源;</li>
<li>资源管理器分配 Executor 资源并启动 StandaloneExecutorBackend,Executor 运行情况将随着心跳发送到资源管理器上;</li>
<li>SparkContext 构建成 DAG 图,将 DAG 图分解成 Stage,并把 Taskset 发送给 Task<br>Scheduler。Executor 向 SparkContext 申请 Task,Task Scheduler 将 Task 发放给<br>Executor 运行同时 SparkContext 将应用程序代码发放给 Executor。</li>
<li>Task 在 Executor 上运行,运行完毕释放所有资源。<br><img src="http://oa4pac8sx.bkt.clouddn.com/sparkcore.png" alt="enter image description here"></li>
</ol>
<h2 id="Spark-Streaming"><a href="#Spark-Streaming" class="headerlink" title="Spark Streaming"></a>Spark Streaming</h2><p>SparkStreaming 是一个对实时数据流进行高通量、容错处理的流式处理系统,可以对多种数据源(如 Kdfka、Flume、Twitter、Zero 和 TCP 套接字)进行类似 Map、Reduce 和 Join等复杂操作,并将结果保存到外部文件系统、数据库或应用到实时仪表盘。计算流程:Spark Streaming 是将流式计算分解成一系列短小的批处理作业。这里的批处理引擎是 Spark Core,也就是把 Spark Streaming 的输入数据按照 batch size(如 1 秒)分成一段一段的数据(Discretized Stream),每一段数据都转换成 Spark 中的 RDD (Resilient Distributed Dataset),然后将 Spark Streaming 中对 DStream 的 Transformation 操作变为针对 Spark 中对 RDD 的 Transformation 操作,将 RDD 经过操作变成中间结果保存在内存中。整个流式计算根据业务的需求可以对中间的结果进行叠加或者存储到外部设备。下图显示了 Spark Streaming 的整个流程。<br><img src="http://oa4pac8sx.bkt.clouddn.com/sparkstreaming.png" alt="enter image description here"></p>
<h2 id="Spark-SQL"><a href="#Spark-SQL" class="headerlink" title="Spark SQL"></a>Spark SQL</h2><p>类似于关系型数据库,SparkSQL 也是语句也是由 Projection(a1,a2,a3)、Data Source(tableA)、Filter(condition)组成,分别对应 sql 查询过程中的 Result、Data Source、Operation,也就是说 SQL 语句按 Result–&gt;Data Source–&gt;Operation 的次序来描述的。<br>当执行 SparkSQL 语句的顺序为:</p>
<ol>
<li>对读入的 SQL 语句进行解析(Parse),分辨出 SQL 语句中哪些词是关键词(如 SELECT、<br>FROM、WHERE),哪些是表达式、哪些是 Projection、哪些是 Data Source 等,从而判断 SQL 语句是否规范;</li>
<li>将 SQL 语句和数据库的数据字典(列、表、视图等等)进行绑定(Bind),如果相关的Projection、Data Source 等都是存在的话,就表示这个 SQL 语句是可以执行的;</li>
<li>一般的数据库会提供几个执行计划,这些计划一般都有运行统计数据,数据库会在这些计划中选择一个最优计划(Optimize);</li>
<li>计划执行(Execute),按 Operation–&gt;Data Source–&gt;Result 的次序来进行的,在执行过程有时候甚至不需要读取物理表就可以返回结果<br><img src="http://oa4pac8sx.bkt.clouddn.com/spqrksql.png" alt="enter image description here"></li>
</ol>
<h2 id="Spark-MLlib"><a href="#Spark-MLlib" class="headerlink" title="Spark MLlib"></a>Spark MLlib</h2><p>从架构图可以看出 MLlib 主要包含三个部分:<br>底层基础:包括 Spark 的运行库、矩阵库和向量库;<br>算法库:包含广义线性模型、推荐系统、聚类、决策树和评估的算法;<br>实用程序:包括测试数据的生成、外部数据的读入等功能。<br><img src="http://oa4pac8sx.bkt.clouddn.com/MLlib.png" alt="enter image description here"></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/07/13/7-13(2)/" itemprop="url">
                  7.13(2)
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-07-13T20:39:42+08:00" content="2016-07-13">
              2016-07-13
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <p>读写图片文件，网上基本什么也查不到<br>手写读写Bmp图片，用spark MLlib的Kmeans对图片进行压缩<br>写了转化成灰度图和RGB图两种</p>
<p>读写Bmp<br><figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</div><div class="line">  * Created by gbw on 16-7-13.</div><div class="line">  */</span></div><div class="line"></div><div class="line"><span class="keyword">import</span> java.io._</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">object</span> <span class="title">BmpIO</span></span></div><div class="line">&#123;</div><div class="line"></div><div class="line">	<span class="comment">//将数据写入文件</span></div><div class="line">	<span class="function"><span class="keyword">def</span> <span class="title">writeBmp</span></span>(bmpPath: <span class="type">String</span>, red: <span class="type">Array</span>[<span class="type">Array</span>[<span class="type">Int</span>]], green: <span class="type">Array</span>[<span class="type">Array</span>[<span class="type">Int</span>]], blue: <span class="type">Array</span>[<span class="type">Array</span>[<span class="type">Int</span>]]) =</div><div class="line">	&#123;</div><div class="line">		<span class="keyword">val</span> fos = <span class="keyword">new</span> <span class="type">FileOutputStream</span>(bmpPath)</div><div class="line">		<span class="keyword">val</span> dos = <span class="keyword">new</span> <span class="type">DataOutputStream</span>(fos)</div><div class="line">		writeBmp24(dos, red, green ,blue)</div><div class="line">		dos.flush()</div><div class="line">		dos.close()</div><div class="line">		fos.close()</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="comment">//写bmp图片的信息头和文件头还有位图数据</span></div><div class="line">	<span class="function"><span class="keyword">def</span> <span class="title">writeBmp24</span></span>(dos: <span class="type">DataOutputStream</span>, red: <span class="type">Array</span>[<span class="type">Array</span>[<span class="type">Int</span>]], green: <span class="type">Array</span>[<span class="type">Array</span>[<span class="type">Int</span>]], blue: <span class="type">Array</span>[<span class="type">Array</span>[<span class="type">Int</span>]]) =</div><div class="line">	&#123;</div><div class="line">		<span class="keyword">val</span> width = red(<span class="number">0</span>).length</div><div class="line">		<span class="keyword">val</span> height = red.length</div><div class="line"></div><div class="line">		<span class="comment">//14字节的文件头</span></div><div class="line">		<span class="comment">//代表BM</span></div><div class="line">		<span class="keyword">val</span> bfType = <span class="number">0x424d</span>.toShort</div><div class="line">		<span class="comment">// bmp文件的大小（2—5字节）</span></div><div class="line">		<span class="keyword">val</span> bfSize = <span class="number">54</span> + width * height * <span class="number">3</span></div><div class="line">		<span class="comment">// 位图文件保留字，必须为0（6-7字节）</span></div><div class="line">		<span class="keyword">val</span> bfReserved1 = <span class="number">0</span></div><div class="line">		<span class="comment">// 位图文件保留字，必须为0（8-9字节）</span></div><div class="line">		<span class="keyword">val</span> bfReserved2 = <span class="number">0</span></div><div class="line">		<span class="comment">// 文件头开始到位图实际数据之间的字节的偏移量（10-13字节）</span></div><div class="line">		<span class="keyword">val</span> bfOffBits = <span class="number">54</span></div><div class="line"></div><div class="line">		dos writeShort bfType</div><div class="line">		dos write(changeByte(bfSize), <span class="number">0</span>, <span class="number">4</span>)</div><div class="line">		dos write(changeByte(bfReserved1), <span class="number">0</span>, <span class="number">2</span>)</div><div class="line">		dos write(changeByte(bfReserved2), <span class="number">0</span>, <span class="number">2</span>)</div><div class="line">		dos write(changeByte(bfOffBits), <span class="number">0</span>, <span class="number">4</span>)</div><div class="line"></div><div class="line">		<span class="comment">//40字节的信息头</span></div><div class="line">		<span class="comment">// 信息头所需的字节数（14-17字节）</span></div><div class="line">		<span class="keyword">val</span> biSize = <span class="number">40</span></div><div class="line">		<span class="comment">// 位图的宽（18-21字节）</span></div><div class="line">		<span class="keyword">val</span> biWidth = width</div><div class="line">		<span class="comment">// 位图的高（22-25字节）</span></div><div class="line">		<span class="keyword">val</span> biHeight = height</div><div class="line">		<span class="comment">// 目标设备的级别，必须是1（26-27字节）</span></div><div class="line">		<span class="keyword">val</span> biPlanes = <span class="number">1</span></div><div class="line">		<span class="comment">// 每个像素所需的位数（28-29字节），必须是1位（双色）、</span></div><div class="line">		<span class="comment">// 4位（16色）、8位（256色）或者24位（真彩色）之一。</span></div><div class="line">		<span class="keyword">val</span> biBitcount = <span class="number">24</span></div><div class="line">		<span class="comment">// 位图压缩类型，必须是0（不压缩）（30-33字节）、</span></div><div class="line">		<span class="comment">//1（BI_RLEB压缩类型）或2（BI_RLE4压缩类型）之一。</span></div><div class="line">		<span class="keyword">val</span> biCompression = <span class="number">0</span></div><div class="line">		<span class="comment">// 实际位图图像的大小，即整个实际绘制的图像大小（34-37字节）</span></div><div class="line">		<span class="keyword">val</span> biSizeImage = width * height</div><div class="line">		<span class="comment">// 位图水平分辨率，每米像素数（38-41字节）这个数是系统默认值</span></div><div class="line">		<span class="keyword">val</span> biXPelsPerMeter = <span class="number">0</span></div><div class="line">		<span class="comment">// 位图垂直分辨率，每米像素数（42-45字节）这个数是系统默认值</span></div><div class="line">		<span class="keyword">val</span> biYPelsPerMeter = <span class="number">0</span></div><div class="line">		<span class="comment">// 位图实际使用的颜色表中的颜色数（46-49字节），</span></div><div class="line">		<span class="comment">// 如果为0的话，说明全部使用了</span></div><div class="line">		<span class="keyword">val</span> biClrUsed = <span class="number">0</span></div><div class="line">		<span class="comment">// 位图显示过程中重要的颜色数(50-53字节)，</span></div><div class="line">		<span class="comment">// 如果为0的话，说明全部重要</span></div><div class="line">		<span class="keyword">val</span> biClrImportant = <span class="number">0</span></div><div class="line"></div><div class="line">		<span class="comment">// 因为是大端存储，那么也就是说同样会大端输出。</span></div><div class="line">		<span class="comment">// 所以首先调用方法将int数据转变为多个byte数据，</span></div><div class="line">		<span class="comment">// 并且按小端存储的顺序.</span></div><div class="line">		dos write(changeByte(biSize), <span class="number">0</span>, <span class="number">4</span>)</div><div class="line">		dos write(changeByte(biWidth), <span class="number">0</span>, <span class="number">4</span>)</div><div class="line">		dos write(changeByte(biHeight), <span class="number">0</span>, <span class="number">4</span>)</div><div class="line">		dos write(changeByte(biPlanes), <span class="number">0</span>, <span class="number">2</span>)</div><div class="line">		dos write(changeByte(biBitcount), <span class="number">0</span>, <span class="number">2</span>)</div><div class="line">		dos write(changeByte(biCompression), <span class="number">0</span>, <span class="number">4</span>)</div><div class="line">		dos write(changeByte(biSizeImage), <span class="number">0</span>, <span class="number">4</span>)</div><div class="line">		dos write(changeByte(biXPelsPerMeter), <span class="number">0</span>, <span class="number">4</span>)</div><div class="line">		dos write(changeByte(biYPelsPerMeter), <span class="number">0</span>, <span class="number">4</span>)</div><div class="line">		dos write(changeByte(biClrUsed), <span class="number">0</span>, <span class="number">4</span>)</div><div class="line">		dos write(changeByte(biClrImportant), <span class="number">0</span>, <span class="number">4</span>)</div><div class="line"></div><div class="line">		<span class="comment">// 因为是24位图，所以没有颜色表</span></div><div class="line">		<span class="comment">// 通过遍历输入位图数据</span></div><div class="line">		<span class="comment">// 这里遍历的时候注意，在计算机内存中位图数据</span></div><div class="line">		<span class="comment">// 是从左到右，从下到上来保存的，</span></div><div class="line">		<span class="comment">// 也就是说实际图像的第一行的点在内存是最后一行</span></div><div class="line">		<span class="keyword">for</span>(i &lt;- height - <span class="number">1</span> to <span class="number">0</span> by <span class="number">-1</span>)</div><div class="line">		&#123;</div><div class="line">			<span class="keyword">for</span>(j &lt;- <span class="number">0</span> to width - <span class="number">1</span>)</div><div class="line">			&#123;</div><div class="line">				dos write(changeByte(blue(i)(j)), <span class="number">0</span>, <span class="number">1</span>)</div><div class="line">				dos write(changeByte(green(i)(j)), <span class="number">0</span>, <span class="number">1</span>)</div><div class="line">				dos write(changeByte(red(i)(j)), <span class="number">0</span>, <span class="number">1</span>)</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line"></div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="comment">// 将一个int数据转为按小端顺序排列的字节数组</span></div><div class="line">	<span class="function"><span class="keyword">def</span> <span class="title">changeByte</span></span>(data: <span class="type">Int</span>): <span class="type">Array</span>[<span class="type">Byte</span>] =</div><div class="line">		<span class="type">Array</span>(((data &lt;&lt; <span class="number">24</span>) &gt;&gt; <span class="number">24</span>).toByte, ((data &lt;&lt; <span class="number">16</span>) &gt;&gt; <span class="number">24</span>).toByte, ((data &lt;&lt; <span class="number">8</span>) &gt;&gt; <span class="number">24</span>).toByte, (data &gt;&gt; <span class="number">24</span>).toByte)</div><div class="line"></div><div class="line">	<span class="comment">// 将四个字节解析成int数据</span></div><div class="line">	<span class="function"><span class="keyword">def</span> <span class="title">ChangeInt</span></span>(array2: <span class="type">Array</span>[<span class="type">Byte</span>], start: <span class="type">Int</span>) =</div><div class="line">	&#123;</div><div class="line">		<span class="keyword">val</span> i = ((array2(start) &amp; <span class="number">0xff</span>) &lt;&lt; <span class="number">24</span>) | ((array2(start - <span class="number">1</span>) &amp; <span class="number">0xff</span>) &lt;&lt; <span class="number">16</span>)</div><div class="line">		<span class="keyword">val</span> j = ((array2(start - <span class="number">2</span>) &amp; <span class="number">0xff</span>) &lt;&lt; <span class="number">8</span>) | (array2(start - <span class="number">3</span>) &amp; <span class="number">0xff</span>)</div><div class="line">		i | j</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="comment">// 读取rgb数据</span></div><div class="line">	<span class="function"><span class="keyword">def</span> <span class="title">getInf</span></span>(bis: <span class="type">BufferedInputStream</span>, height: <span class="type">Int</span>, width: <span class="type">Int</span>) =</div><div class="line">	&#123;</div><div class="line">		<span class="keyword">val</span> red = <span class="type">Array</span>.ofDim[<span class="type">Int</span>](height, width)</div><div class="line">		<span class="keyword">val</span> green = <span class="type">Array</span>.ofDim[<span class="type">Int</span>](height, width)</div><div class="line">		<span class="keyword">val</span> blue = <span class="type">Array</span>.ofDim[<span class="type">Int</span>](height, width)</div><div class="line"></div><div class="line">		<span class="comment">// 计算系统在每行的填充的字节数</span></div><div class="line">		<span class="keyword">val</span> m = width * <span class="number">3</span> % <span class="number">4</span></div><div class="line">		<span class="keyword">var</span> skip_width = <span class="number">0</span></div><div class="line">		<span class="keyword">if</span>(m != <span class="number">0</span>)</div><div class="line">			skip_width = <span class="number">4</span> - m</div><div class="line"></div><div class="line">		<span class="keyword">for</span> (i &lt;- height - <span class="number">1</span> to <span class="number">0</span> by <span class="number">-1</span>)</div><div class="line">		&#123;</div><div class="line">			<span class="keyword">for</span> (j &lt;- <span class="number">0</span> to width - <span class="number">1</span>)</div><div class="line">			&#123;</div><div class="line">				blue(i)(j) = bis.read</div><div class="line">				green(i)(j) = bis.read</div><div class="line">				red(i)(j) = bis.read</div><div class="line">				<span class="keyword">if</span> (j == <span class="number">0</span>)</div><div class="line">					bis skip skip_width</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line">		(red, green, blue)</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">def</span> <span class="title">readBmp</span></span>(bmpPath: <span class="type">String</span>) =</div><div class="line">	&#123;</div><div class="line">		<span class="keyword">val</span> fin = <span class="keyword">new</span> <span class="type">FileInputStream</span>(bmpPath)</div><div class="line">		<span class="keyword">val</span> bis = <span class="keyword">new</span> <span class="type">BufferedInputStream</span>(fin)</div><div class="line">		<span class="comment">// 获得文件头和信息头的数据</span></div><div class="line">		<span class="comment">//分别是14字节和40字节</span></div><div class="line">		<span class="keyword">val</span> array1 = <span class="keyword">new</span> <span class="type">Array</span>[<span class="type">Byte</span>](<span class="number">14</span>)</div><div class="line">		bis.read(array1, <span class="number">0</span>, <span class="number">14</span>)</div><div class="line">		<span class="keyword">val</span> array2 = <span class="keyword">new</span> <span class="type">Array</span>[<span class="type">Byte</span>](<span class="number">40</span>)</div><div class="line">		bis.read(array2, <span class="number">0</span>, <span class="number">40</span>)</div><div class="line"></div><div class="line">		<span class="comment">// 解析信息头的数据得到位图数据的宽和高</span></div><div class="line">		<span class="keyword">val</span> width = <span class="type">BmpIO</span>.<span class="type">ChangeInt</span>(array2, <span class="number">7</span>)</div><div class="line">		<span class="keyword">val</span> height = <span class="type">BmpIO</span>.<span class="type">ChangeInt</span>(array2, <span class="number">11</span>)</div><div class="line"></div><div class="line">		<span class="comment">//println(s"width: $width, height: $height")</span></div><div class="line">		<span class="keyword">val</span> (red, green, blue) = <span class="type">BmpIO</span>.getInf(bis, height, width)</div><div class="line">		fin.close()</div><div class="line">		bis.close()</div><div class="line">		(width, height, red, green, blue)</div><div class="line">	&#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
          <div class="post-more-link text-center">
            <a class="btn" href="/2016/07/13/7-13(2)/#more" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/2/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><span class="page-number current">3</span><a class="page-number" href="/page/4/">4</a><a class="page-number" href="/page/5/">5</a><a class="extend next" rel="next" href="/page/4/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel  sidebar-panel-active ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="http://oa4pac8sx.bkt.clouddn.com/u=4284545010,775528643&fm=21&gp=0.jpg"
               alt="GBW" />
          <p class="site-author-name" itemprop="name">GBW</p>
          <p class="site-description motion-element" itemprop="description">Scala,Spark</p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">42</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          

          
            <div class="site-state-item site-state-tags">
              
                <span class="site-state-item-count">6</span>
                <span class="site-state-item-name">标签</span>
              
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/GBWen" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://blog.sina.com.cn/u/5660562931" target="_blank" title="曾经博客">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                  曾经博客
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://user.qzone.qq.com/376366210" target="_blank" title="QQ空间">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                  QQ空间
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://www.zhihu.com/people/guan-bo-wen-98" target="_blank" title="知乎">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                  知乎
                </a>
              </span>
            
          
        </div>

        
        

        
        

      </section>

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy;  2016 - 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">GBW</span>
</div>

<div class="powered-by">
  由 <a class="theme-link" href="http://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Pisces
  </a>
</div>

        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.0.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.0.1"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.0.1"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.0.1"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.0.1"></script>



  



  




  
  

  

  

  

</body>
</html>
